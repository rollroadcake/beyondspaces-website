!function(e){var t;_.templateSettings={evaluate:/\{\{(.+?)\}\}/g,interpolate:/\{\{=(.+?)\}\}/g,escape:/\{\{-(.+?)\}\}/g},window.Builderius=window.Builderius||{},(t=window.Builderius={Models:{},Collections:{},Views:{},_ajax_sent:!1,_builderId:"#"+builderiusCfg.builderId,_contentClass:!1,_dragging:!1,_modal_on:!1,_option_slug:null,_panel_on:!1,_optionVars:{},_optionTypes:{},_queryBuilderFilter:[],scroll_table:{},_shipping_classes:[],_init:function(){e("body").addClass("builderius");const o=t._initCheckups();if(o.error){for(let e of o.msg)console.info("Uni CPO @",e);setTimeout((()=>{this._showMessage(o.msg.pop(),"warning")}),2200)}if(null===t.getElById(t._builderId.substring(1)))return!1;t._initClasses(),t._resetListOfVars();const i=new t.Models.BuilderModel({autosaveData:t._autosaveGetData(),discountsData:builderiusCfg.product.discounts_data,formulaData:builderiusCfg.product.formula_data,imageData:builderiusCfg.product.image_data,id:builderiusCfg.product.id,novData:builderiusCfg.product.nov_data,settingsData:builderiusCfg.product.settings_data,weightData:builderiusCfg.product.weight_data,shippingClassData:builderiusCfg.product.shipping_class_data,dimensionsData:builderiusCfg.product.dimensions_data,uri:builderiusCfg.product.uri});t.builderCol=new t.Collections.BuilderCollection,t.builderCol.add(i),t.Panel=new t.Views.Panel({collection:t.builderCol,model:i}).render(),t.rowsCol=new t.Collections.Rows,t.BuilderView=(new t.Views.Builder).render(),_.isEmpty(builderiusCfg.product.content)?t.rowsCol.add([],{parse:!0}):(t.rowsCol.add(builderiusCfg.product.content,{parse:!0}),t._updateListOfVars()),t._initSortables(),e("#uni-builder-panel").hasClass("uni-panel-left")?t._initTooltip(e("#uni-builder-panel"),"left bottom","left top-10"):t._initTooltip(e("#uni-builder-panel"),"right bottom","right top-10"),t._showRevHistory(),t._shipping_classes=window.builderiusCfg.shipping_classes},_initCheckups:function(){let t=!1,o=[];const i=e(".uni-builderius-container").closest("form.cart"),n=e(builderiusCfg.price_selector),a=e(builderiusCfg.image_selector);return i.length||(t=!0,o.push(builderius_i18n.misconfig.no_form)),i.length>1&&(t=!0,o.push(builderius_i18n.misconfig.many_forms)),builderiusCfg.regular_price||(t=!0,o.push(builderius_i18n.misconfig.free)),n.length||(t=!0,o.push(builderius_i18n.misconfig.no_price_tag)),a.length||(t=!0,o.push(builderius_i18n.misconfig.no_image_tag)),{error:t,msg:o}},_initClasses:function(){t._contentClass="builderius-content-"+builderiusCfg.product.id,e(t._builderId).addClass(t._contentClass)},_initSortables:function(){const o={appendTo:document.body,cursor:"move",cursorAt:{left:0,top:20},scrollSensitivity:100,placeholder:"uni-builder-drop-zone",over:t._itemOver,out:t._itemOut,beforeStop:t._itemBeforeStop,start:t._itemDragStart,stop:t._itemDragStop,helper:t._itemDragHelper};e(".uni-builder-panel-row-items").sortable(e.extend({},o,{connectWith:e(t._builderId),items:".js-panel-block-type-row"})),e(".uni-builder-panel-column-items").sortable(e.extend({},o,{connectWith:".uni-row-content",items:".js-panel-block-type-column"})),e(".uni-builder-panel-module-items").sortable(e.extend({},o,{connectWith:".uni-col-content",items:".js-panel-block-type-module"})),e(".uni-builder-panel-option-items").sortable(e.extend({},o,{connectWith:".uni-col-content",items:".js-panel-block-type-option"})),e(t._builderId).sortable(e.extend({},o,{connectWith:e(t._builderId),items:".uni-row",handle:".js-uni-row-move"})),e(".uni-row-content").sortable(e.extend({},o,{connectWith:".uni-row-content",items:".uni-col",handle:".js-uni-col-move"})),e(".uni-col-content").sortable(e.extend({},o,{connectWith:".uni-col-content",items:".uni-module",handle:".js-uni-module-move"}))},_initTooltip:function(t,o,i){let n={collision:"none",using:function(t,o){e(this).css(t),e(this).addClass("vertical-"+o.vertical).addClass("horizontal-"+o.horizontal)}};void 0!==o&&void 0!==i?(n.my=o,n.at=i):(n.my="center bottom",n.at="center top-10"),t.tooltip({items:"[data-tip]",show:{effect:"show",duration:0},hide:{effect:"hide",duration:0},close:function(){e(".ui-helper-hidden-accessible").remove()},position:n,content:function(){return e(this).attr("data-tip")}})},_initRangeSlider:function(e){e.ionRangeSlider()},_initGoogleMap:function({id:e,coords:t,zoom:o}){const i=document.getElementById(e);if(null==i)return;console.log(i);const n=t.split(","),a=parseFloat(n[0]),s=parseFloat(n[1]);console.log(a,s,o);new google.maps.Map(i,{center:{lat:a,lng:s},zoom:o})},_itemDragStart:function(o,i){t._dragging=!0,e(t._builderId).addClass("uni-builder-drag-started");1===e(this).children(".uni-row, .uni-col, .uni-module").length&&(e(this).hasClass("uni-row-content")?e(this).closest(".uni-row").addClass("uni-row-highlight"):e(this).closest(".uni-col").addClass("uni-col-highlight")),t.parentRowId=e(this).closest(".uni-row").data("node"),t.parentColId=e(this).closest(".uni-col").data("node");const n=i.item.data("type").replace("_"," ");switch(i.placeholder.text(n),n){case"row":e(t._builderId).addClass("uni-builder-row-drag-started");break;case"column":e(t._builderId).addClass("uni-builder-column-drag-started"),e(t._builderId).children().length||t._showMessage('You have to add "Row" module first',"warning");break;default:e(t._builderId).addClass("uni-builder-module-drag-started"),e(t._builderId).children().length||t._showMessage('You have to add "Row" module first',"warning")}t.closePanel()},_itemDragHelper:function(t,o){o.hasClass("uni-builder-panel-block")&&o.clone().insertAfter(o);const i=o.data("type").replace("_"," ");return e('<div class="uni-builder-block-drag-helper">'+i+"</div>")},_itemDragStop:function(o,i){t._dragging=!1,e(t._builderId).removeClass("uni-builder-drag-started uni-builder-row-drag-started uni-builder-column-drag-started uni-builder-module-drag-started");const n=i.item,a=n.parent(),s=n.data("node"),l=n.index(),r=n.data("type"),c={id:s,order:l,type:r,obj_type:n.data("obj_type")};if(!n.closest(".uni-builder-panel-items").hasClass("uni-builder-panel-items")&&t.dropIn){switch(r){case"row":void 0===s?(t.BuilderView.createRowAndCol(c),n.remove()):t._setRowsOrder();break;case"column":if(void 0===s)c.parentRowId=a.closest(".uni-row").data("node"),t.BuilderView.createCol(c),n.remove();else{const e=t.parentRowId,o=a.closest(".uni-row").data("node");e!==o?(c.parentRowId=e,c.newParentRowId=o,t.BuilderView.moveCol(c),n.remove()):t._setColsOrder(o)}break;default:if(void 0===s)c.parentRowId=a.closest(".uni-row").data("node"),c.parentColumnId=a.closest(".uni-col").data("node"),t.BuilderView.createModule(c),n.remove();else{c.parentRowId=t.parentRowId;const e=a.closest(".uni-row").data("node");c.newParentRowId=e;const o=t.parentColId,i=a.closest(".uni-col").data("node");o!==i?(c.parentColumnId=o,c.newParentColumnId=i,t.BuilderView.moveModule(c),n.remove()):t._setModulesOrder(e,i)}}t._initSortables(),t._ifEmptyItem(),t._addWarningClass()}else n.remove()},_itemOver:function(o,i){t.sortableIn=!0,e(t._builderId).find(".uni-builder-drop-zone").show()},_itemOut:function(o,i){t.sortableIn=!1,e(t._builderId).find(".uni-builder-drop-zone").hide()},_itemBeforeStop:function(e,o){t.dropIn=t.sortableIn},_ifEmptyItem:function(){t.rowsCol.each((function(o){const i=e(t._builderId).find('div[data-node="'+o.id+'"]');0===o.columns.length?i.removeClass("uni-row-overlay-muted").addClass("uni-row-highlight"):i.removeClass("uni-row-highlight"),o.columns.each((function(o){const i=e(t._builderId).find('div[data-node="'+o.id+'"]');0===o.modules.length?i.removeClass("uni-col-overlay-muted").addClass("uni-col-highlight"):i.removeClass("uni-col-highlight")}))}))},_setRowsOrder:function(){let o=0;e(t._builderId).find(".uni-row").each((function(){const i=e(this).data("node");t.rowsCol.get(i).set({order:o}),o++})),t.rowsCol.sort()},_setColsOrder:function(o){if(0===t.rowsCol.get(o).columns.length)return;let i=0;e(t._builderId).find('div[data-node="'+o+'"]').find(".uni-col").each((function(){const n=e(this).data("node");void 0!==t.rowsCol.get(o).columns.get(n)&&(t.rowsCol.get(o).columns.get(n).set({order:i}),i++)})),t.rowsCol.sort()},_setModulesOrder:function(o,i){if(0===t.rowsCol.get(o).columns.length||0===t.rowsCol.get(o).columns.get(i).modules.length)return;let n=0;e(t._builderId).find('div[data-node="'+o+'"]').find('div[data-node="'+i+'"]').find(".uni-module").each((function(){const a=e(this).data("node");void 0!==t.rowsCol.get(o).columns.get(i)&&void 0!==t.rowsCol.get(o).columns.get(i).modules.get(a)&&(t.rowsCol.get(o).columns.get(i).modules.get(a).set({order:n}),n++)})),t.rowsCol.get(o).columns.get(i).modules.sort()},closePanel:function(){t._panel_on=!1,e("body.uni-builder-panel-on").removeClass("uni-builder-panel-on"),e(".uni-builder-panel-switch.uni-active").removeClass("uni-active")},showPanel:function(){t._panel_on=!0,e("body").addClass("uni-builder-panel-on"),e(".uni-builder-panel-switch").addClass("uni-active")},_destroyScroll:function(o){const i=e("#"+o).data("row");void 0!==t.scroll_table[i]&&t.scroll_table[i].destroy(),void 0!==t.scroll_matrix_table&&t.scroll_matrix_table.destroy()},_initScroll:function(o){const i=e("#"+o),n=i.data("row"),a=i.closest(".uni-matrix-table-wrapper");void 0!==typeof n?t.scroll_table[n]=a.jScrollPane({mouseWheelSpeed:40,autoReinitialise:!0}).data().jsp:t.scroll_matrix_table=a.jScrollPane({mouseWheelSpeed:40,autoReinitialise:!0}).data().jsp},_showRevHistory:function(){const o="js-revision-history-switch",i=e("#"+o),n="uni-revision-history-wrap",a=e("."+n);i.on("click",(function(o){o.preventDefault(),e(this).hasClass("uni-clicked")?(e(this).removeClass("uni-clicked"),a.slideUp(300,(function(){t.scroll_history.destroy()}))):(e(this).addClass("uni-clicked"),a.slideDown(300,(function(){t.scroll_history=e(".uni-revision-items").jScrollPane({mouseWheelSpeed:40}).data().jsp})))})),e(document).on("click",(function(s){e(s.target).hasClass(n)||e(s.target).parents().hasClass(n)||e(s.target).attr("id")===o||!i.hasClass("uni-clicked")||(a.slideUp(300,(function(){t.scroll_history.destroy()})),i.removeClass("uni-clicked"))}))},_addWarningClass:function(){e("#uni-builder-panel").addClass("uni-builder-panel-warning")},_removeWarningClass:function(){e("#uni-builder-panel").removeClass("uni-builder-panel-warning")},adminAjaxSyncableMixin:{url:builderiusCfg.ajax_url,sync:function(e,t,o){if(void 0===o.data&&(o.data={}),o.data.security=builderiusCfg.security,void 0===o.data.action&&void 0!==o.action&&(o.data.action=o.action),this.trigger("request",t,o),"read"===e)return Backbone.sync(e,t,o);if("delete"===e)return;const i=this.toJSON(),n={};return i instanceof Array?n.models=i:n.model=i,_.extend(o.data,n),o.emulateJSON=!0,Backbone.sync.call(this,"create",t,o)}},_autosave:function(){try{const e=moment().unix(),o=JSON.stringify(t.rowsCol.toJSON()),i=builderiusCfg.product.id;if(window.localStorage){localStorage.setItem("_cpo_autosave_time_"+i,e),localStorage.setItem("_cpo_autosave_data_"+i,o);t.builderCol.get(builderiusCfg.product.id).set({autosaveData:{timestamp:e,content:o}})}else console.log("Your browser does not support LocalStorage")}catch(e){console.warn("It looks like there is a problem with localStorage of your browser. Read below the full error message:"),console.error(e)}},_autosaveGetData:function(){if(window.localStorage){const e=builderiusCfg.product.id;return{timestamp:localStorage.getItem("_cpo_autosave_time_"+e),content:localStorage.getItem("_cpo_autosave_data_"+e)}}return console.log("Your browser does not support LocalStorage"),{}},_blockForm:function(o){t._ajax_sent=!0,e(o).block({message:'<div data-loader="circle"></div>',css:{width:"auto",border:"0px",background:"transparent"},overlayCSS:{background:"#fff",opacity:.7},baseZ:9999996})},_conditionalFields:function(o=""){const i=e("[data-uni-constrained]"),n={};i.each((function(o,i){const a=e(i),s=a.data("uni-constrained");let l=a.data("uni-constvalue");const r=e(s);if(void 0!==s&&r.length){let o;void 0!==n[s]?o=n[s]:(r.length>1?"radio"===r[0].type?(e.each(r,(function(t,i){const n=e(i);n.is(":checked")&&(o=n.val())})),void 0===o&&(o="")):"checkbox"===r[0].type&&(o=[],e.each(r,(function(t,i){const n=e(i);n.is(":checked")&&o.push(n.val())})),void 0===o&&(o=[])):o="checkbox"===r[0].type?r.hasClass("builderius-single-checkbox")?r.is(":checked")?"on":"off":r.is(":checked")?r.val():"":r.val(),n[s]=o);const i=a.find("input, select, textarea").not(".wp-picker-clear");null!==l.match(/\|/)&&(l=l.split("|")),t._isEqual(l,o)?(i.length>0&&e.each(i,(function(){const t=e(this);t.hasClass("builderius-setting-excluded")||t.not(".flatpickr-hour, .flatpickr-minute, .cur-year, .uni-cpo-non-option-vars-options-template textarea, .uni-cpo-non-option-vars-options-template input").addClass("builderius-setting-field")})),a.is(":input")&&!a.hasClass("builderius-setting-excluded")&&a.not(".flatpickr-hour, .flatpickr-minute, .cur-year").addClass("builderius-setting-field"),a.show()):(i.length>0&&e.each(i,(function(){e(this).removeClass("builderius-setting-field")})),a.is(":input")&&a.removeClass("builderius-setting-field"),a.hide())}}))},_isEqual:function(e,t){return _.isString(e)&&_.isString(t)?e===t:_.isString(e)&&_.isArray(t)?-1!==_.indexOf(t,e):_.isArray(e)&&_.isString(t)?-1!==_.indexOf(e,t):void 0},_convertHex:function(e,t){e=e.replace("#","");return"rgba("+parseInt(e.substring(0,2),16)+","+parseInt(e.substring(2,4),16)+","+parseInt(e.substring(4,6),16)+","+t/100+")"},_convertRgba:function(e){const t=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return t&&4===t.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""},_customSelectEvents:function(){const t=e('div[data-group="border"]'),o=e('input[id*="uni-setting-border"][id*="width-linked"]'),i=t.find(".uni-custom-select-list"),n=t.find(".uni-custom-select-head"),a=t.find(".uni-custom-select-wrap select");i.find("li").on("click",(function(){const t=e(this).closest(".uni-custom-select-list"),s=e(this).closest(".uni-custom-select-wrap").find(".uni-custom-select-head"),l=e(this).closest(".uni-custom-select-wrap").find("select"),r=e(this).data("value");if(o.is(":checked")){const t=e(this).html();a.val(r),i.slideUp(200),i.find('li[data-selected="selected"]').removeAttr("data-selected"),i.find('li[data-value="'+r+'"]').attr("data-selected","selected"),n.removeClass("clicked").html(t)}else if("selected"==e(this).data("selected"))t.slideUp(200),s.removeClass("clicked");else{const o=e(this).html();t.find('li[data-selected="selected"]').removeAttr("data-selected"),e(this).attr("data-selected","selected"),l.val(r),s.removeClass("clicked").html(o),t.slideUp(200)}}))},_generateCustomSelectHtml:function(o){o.each((function(){const t=e(this),o=t.find("select"),i=o.val(),n=o.find("option");e('<div class="uni-custom-select-head"></div><ul class="uni-custom-select-list"></ul>').insertAfter(o),o.hide();const a=t.find(".uni-custom-select-list"),s=t.find(".uni-custom-select-head");"none"===i?s.html("None"):s.html('<img src="'+builderiusCfg.cpo_data.border_images[i]+'" alt="Border type '+i+' image">'),n.each((function(){const t=e(this).val();let o="",n="",s="";"none"===t?o=t:s='<img src="'+builderiusCfg.cpo_data.border_images[t]+'" alt="Border type '+t+' image">',i===t&&(n='data-selected="selected"'),a.append("<li "+n+' data-value="'+t+'">'+o+s+"</li>")}))}));const i=".uni-custom-select-wrap",n=".uni-custom-select-list",a="clicked";e(".uni-custom-select-head").on("click",(function(){const t=e('[data-group="border"]').find(".uni-custom-select-head.clicked");e(this).hasClass(a)?e(this).removeClass(a).closest(i).find(n).slideUp(200):(t.length>0&&t.each((function(){e(this).removeClass(a).closest(i).find(n).slideUp(200)})),e(this).addClass(a).closest(i).find(n).slideDown(200))})),e(document).on("click",(function(t){if(!e(t.target).parents().hasClass("uni-custom-select-wrap")){const t=e('[data-group="border"]').find(".uni-custom-select-head.clicked");t.length>0&&t.each((function(){e(this).removeClass(a).closest(i).find(n).slideUp(200)}))}})),t._customSelectEvents()},getUniqueId:()=>Math.random().toString(16).substr(2,8),getElById:e=>document.getElementById(e),_hidePremiumContent:function(t){t.length>0&&t.each((function(){const t='<div class="uni-premium-overlay"></div><div class="uni-premium-overlay-text">'+builderius_i18n.pro+"</div>";e(this).append(t)}))},_linkedFields:function(){e("[data-linked-checkbox]").each((function(){const t=e(this),o=t.data("linked-checkbox").split("|");let i='input[type="text"]';o.forEach((function(e,t){i+="[name*="+e+"]"}));const n=e(""+i);n.on("keyup",(function(){if(t.length&&t.is(":checked")){const t=e(this).val();n.not(e(this)).val(t)}}))}))},_parseNameWithBrackets:function(e){const t=e.match(/\[(.*)\]/);let o=[];const i=/\[(.*?)\]/g;let n;if(null!==t){for(;null!==(n=i.exec(e));)o.push(n[1]);return{name:e=e.replace(t[0],""),matches:o}}return{name:e}},_readSettingsModal:function(o){const i=o.$el.find(".builderius-setting-field").not(".builder-setting-excluded"),n={data:{},valid:!0};return i.each((function(){const o=this.type||this.tagName.toLowerCase(),i=e(this),a=i.parsley();let s=i.attr("name");if(a.validate(),a.isValid()){const a=t._parseNameWithBrackets(s);if(a.matches&&(void 0===n.data[a.name]&&(n.data[a.name]={}),void 0===n.data[a.name][a.matches[0]]&&void 0!==a.matches[0]&&(n.data[a.name][a.matches[0]]={}),void 0===n.data[a.name][a.matches[0]][a.matches[1]]&&void 0!==a.matches[1]&&(n.data[a.name][a.matches[0]][a.matches[1]]={}),void 0===n.data[a.name][a.matches[0]][a.matches[1]][a.matches[2]]&&void 0!==a.matches[2]&&(n.data[a.name][a.matches[0]][a.matches[1]][a.matches[2]]={})),"checkbox"===o)if(i.hasClass("builderius-single-checkbox"))i.is(":checked")?a.matches?void 0===a.matches[2]||_.isEmpty(a.matches[2])?void 0===a.matches[1]||_.isEmpty(a.matches[1])?_.isEmpty(a.matches[0])?n.data[a.name]=i.val():n.data[a.name][a.matches[0]]=i.val():n.data[a.name][a.matches[0]][a.matches[1]]=i.val():n.data[a.name][a.matches[0]][a.matches[1]][a.matches[2]]=i.val():n.data[s]=i.val():a.matches?void 0===a.matches[2]||_.isEmpty(a.matches[2])?void 0===a.matches[1]||_.isEmpty(a.matches[1])?_.isEmpty(a.matches[0])?n.data[a.name]="off":n.data[a.name][a.matches[0]]="off":n.data[a.name][a.matches[0]][a.matches[1]]="off":n.data[a.name][a.matches[0]][a.matches[1]][a.matches[2]]="off":n.data[s]="off";else{const t=[];e('input[name="'+this.name+'"]:checked').each((function(){t.push(e(this).val())})),void 0===a.matches[2]||_.isEmpty(a.matches[2])?void 0===a.matches[1]||_.isEmpty(a.matches[1])?_.isEmpty(a.matches[0])?n.data[a.name]=t:n.data[a.name][a.matches[0]]=t:n.data[a.name][a.matches[0]][a.matches[1]]=t:n.data[a.name][a.matches[0]][a.matches[1]][a.matches[2]]=t}else"radio"===o?i.attr("checked")&&(n.data[s]=i.val()):a.matches?void 0!==a.matches[2]?n.data[a.name][a.matches[0]][a.matches[1]][a.matches[2]]=i.val():void 0!==a.matches[1]?n.data[a.name][a.matches[0]][a.matches[1]]=i.val():n.data[a.name][a.matches[0]]=i.val():n.data[s]=i.val()}else n.valid=!1})),n},_showMessage:function(t="",o="success"){if(e("body").hasClass("builderius")&&""!==t){e("body").prepend(`<div id="uni_message">${t}</div>`);const i=jQuery("#uni_message");"success"===o&&i.addClass("uni-success-message"),"warning"===o&&i.addClass("uni-warning-message"),"error"==o&&i.addClass("uni-error-message"),i.fadeIn(400).dequeue().animate({right:25},250,(function(){setTimeout((function(){i.animate({right:-125},250).dequeue().fadeOut(400,(function(){setTimeout((function(){i.removeClass("uni-success-message uni-warning-message uni-error-message")}),1)}))}),3e3)}))}},_unblockForm:function(o,i){t._ajax_sent=!1,e(document).find('.blockMsg > div[data-loader="circle"]').remove(),e(document).find(".blockMsg").html('<div class="uni-ajax-'+i+'"><div>'),e(".uni-ajax-"+i).fadeIn(500),setTimeout((function(){e(o).unblock()}),1500)},_getQueryBuilderFilter:function(e="",o=""){let i=t._queryBuilderFilter;const n=builderiusCfg.cpo_data.var_slug;if(e){const t=e.get("type"),a="row"===t?builderiusModules.module[t]:builderiusModules.option[t];if(void 0===a)return;if("self"===o){self=_.reject(i,(function(t){return t.id!==n+e.get("settings").cpo_general.main.cpo_slug}));let t=[],o=[];_.isEmpty(a.special_vars)||a.special_vars.forEach((a=>{o=_.filter(i,(function(t){return t.id===n+e.get("settings").cpo_general.main.cpo_slug+"_"+a})),t=t.concat(o)})),i=self.concat(t)}else"date_rules"===o?_.isEmpty(a.special_vars)||a.special_vars.forEach((t=>{"start"===t&&(i=_.filter(i,(function(o){return o.id===n+e.get("settings").cpo_general.main.cpo_slug+"_"+t})))})):"row"!==t&&(i=_.reject(i,(function(t){return t.id===n+e.get("settings").cpo_general.main.cpo_slug})),_.isEmpty(a.special_vars)||a.special_vars.forEach((t=>{i=_.reject(i,(function(o){return o.id===n+e.get("settings").cpo_general.main.cpo_slug+"_"+t}))})));return i}if("formula_rules"===o){if(void 0===i.filter((e=>"currency"===e.id)).shift()){const e={id:"currency",input:"text",label:"currency code",operators:["equal","not_equal"],type:"string"};i.push(e)}}return i},_getSuboptionsFormatted(e){let t={};return _.each(e,(function(e){t[e.slug]=e.label})),t},_resetListOfVars:function(){t._optionVars={builtin:["uni_cpo_price"],regular:[],special:[],nov:[],matrix:[]},t._queryBuilderFilter=[],t._optionTypes={}},_updateListOfVars:function(){t._resetListOfVars();const e=builderiusCfg.cpo_data.var_slug,o=builderiusCfg.cpo_data.nov_slug;t.rowsCol.each((function(o){o.columns.each((function(o){o.modules.map((o=>{const i=o.get("obj_type"),n=o.get("type"),a=builderiusModules[i][n],s=o.get("settings");if("dynamic_notice"===n)return!0;if("checkbox"===n&&"option"===i&&void 0!==s.cpo_general&&!_.isEmpty(s.cpo_general.main.cpo_slug)){const o=e+s.cpo_general.main.cpo_slug;t._optionTypes[o]="checkbox"}if("option"===i&&void 0!==s.cpo_general&&!_.isEmpty(s.cpo_general.main.cpo_slug)){const o=e+s.cpo_general.main.cpo_slug;t._optionVars.regular.push(o),t._optionVars.regular=_.uniq(t._optionVars.regular);const i=void 0!==s.cpo_general.main.cpo_type?s.cpo_general.main.cpo_type:"string",n=a.filter_data.input,l={id:o,label:`{${o}}`,type:i,input:n,operators:a.filter_data.operators};if(-1!==_.indexOf(["select","radio"],n)&&s.cpo_suboptions&&void 0!==s.cpo_suboptions.data){const e=s.cpo_suboptions.data;let o={};void 0!==e.cpo_radio_options&&(o=t._getSuboptionsFormatted(e.cpo_radio_options)),void 0!==e.cpo_select_options&&(o=t._getSuboptionsFormatted(e.cpo_select_options)),l.values=o}if((_.isEmpty(t._queryBuilderFilter)||void 0===_.findWhere(t._queryBuilderFilter,l))&&t._queryBuilderFilter.push(l),!_.isEmpty(a.special_vars)&&!_.isEmpty(a.filter_data.special_vars)){let e=[].concat(a.special_vars);"single"===s.cpo_general.main.cpo_date_type&&(e.splice(e.indexOf("duration"),1),e.splice(e.indexOf("end"),1),e.splice(e.indexOf("days"),1)),"multiple"===s.cpo_general.main.cpo_date_type&&e.splice(e.indexOf("end"),1),"range"===s.cpo_general.main.cpo_date_type&&e.splice(e.indexOf("days"),1),e.forEach((e=>{const i=`${o}_${e}`;t._optionVars.special.push(i);const n={id:i,label:`{${i}}`,type:a.filter_data.special_vars[e].type,input:a.filter_data.special_vars[e].input,operators:a.filter_data.special_vars[e].operators};void 0!==a.filter_data.special_vars[e].validation&&(n.validation=a.filter_data.special_vars[e].validation),void 0!==a.filter_data.special_vars[e].plugin&&(n.plugin=a.filter_data.special_vars[e].plugin),void 0!==a.filter_data.special_vars[e].plugin_config&&(n.plugin_config=a.filter_data.special_vars[e].plugin_config),void 0===_.findWhere(t._queryBuilderFilter,n)&&t._queryBuilderFilter.push(n)}))}}}))}))})),t._queryBuilderFilter=_.unique(t._queryBuilderFilter,"id"),t._optionVars.regular=_.uniq(t._optionVars.regular),t._optionVars.special=_.uniq(t._optionVars.special);const i=t.builderCol.at(0).get("novData");"on"===i.nov_enable&&null!==i.nov&&_.each(i.nov,(function(e){t._optionVars.nov.push(`${o}${e.slug}`);const i=`${o}${e.slug}`,n={id:i,label:`{${i}}`,type:"double",input:"text",operators:["less","less_or_equal","equal","not_equal","greater_or_equal","greater","is_empty","is_not_empty","between","not_between"]};void 0===_.findWhere(t._queryBuilderFilter,n)&&t._queryBuilderFilter.push(n)}))}}).Models.BuilderModel=Backbone.Model.extend({defaults:{autosaveData:{},discountsData:{},formulaData:{},imageData:{},id:null,novData:{},settingsData:{},weightData:{},shippingClassData:{},dimensionsData:{},uri:null},url:t.adminAjaxSyncableMixin.url,sync:t.adminAjaxSyncableMixin.sync,initialize:function(){},toJSON:function(){return _.clone(this.attributes)}}),t.Models.Row=Backbone.Model.extend({defaults:{id:null,order:null,obj_type:null,pid:null,settings:{},title:null,type:null},url:t.adminAjaxSyncableMixin.url,sync:t.adminAjaxSyncableMixin.sync,initialize:function(){if(null===this.get("id")){const e=t.getUniqueId();this.set({id:e})}_.defaults(this,{columns:new t.Collections.Columns})},duplicate:function(){const e=_.clone(this.attributes);return e.id=t.getUniqueId(),new this.constructor(e)},parse:function(e){return _.has(e,"columns")&&(this.columns=new t.Collections.Columns(e.columns,{parse:!0}),delete e.columns),e},toJSON:function(){const e=_.clone(this.attributes);return e.columns=this.columns.toJSON(),e}}),t.Models.Column=Backbone.Model.extend({defaults:{id:null,order:null,obj_type:null,parentRowId:null,pid:null,settings:{},title:null,type:null},url:t.adminAjaxSyncableMixin.url,sync:t.adminAjaxSyncableMixin.sync,initialize:function(){if(!this.get("id")){const e=t.getUniqueId();this.set({id:e})}_.defaults(this,{modules:new t.Collections.Modules})},duplicate:function(){const e=_.clone(this.attributes);return e.id=t.getUniqueId(),new this.constructor(e)},parse:function(e){return _.has(e,"modules")&&(this.modules=new t.Collections.Modules(e.modules,{parse:!0}),delete e.modules),e},toJSON:function(){const e=_.clone(this.attributes);return e.modules=this.modules.toJSON(),e}}),t.Models.Module=Backbone.Model.extend({defaults:{id:null,order:null,obj_type:null,parentColumnId:null,parentRowId:null,pid:null,settings:{},title:null,type:null},url:t.adminAjaxSyncableMixin.url,sync:t.adminAjaxSyncableMixin.sync,initialize:function(){if(!this.get("id")){const e=t.getUniqueId();this.set({id:e})}},duplicate:function(){const e=_.clone(this.attributes);return e.id=t.getUniqueId(),new this.constructor(e)}}),t.Collections.BuilderCollection=Backbone.Collection.extend({model:t.Models.BuilderModel,sync:t.adminAjaxSyncableMixin.sync,url:t.adminAjaxSyncableMixin.url}),t.Collections.Rows=Backbone.Collection.extend({comparator:"order",model:t.Models.Row,sync:t.adminAjaxSyncableMixin.sync,url:t.adminAjaxSyncableMixin.url}),t.Collections.Columns=Backbone.Collection.extend({comparator:"order",model:t.Models.Column}),t.Collections.Modules=Backbone.Collection.extend({comparator:"order",model:t.Models.Module}),t.Views.Panel=Backbone.View.extend({el:"body",template:_.template(e("#js-builderius-panel-tmpl").html()),autosaveTmpl:_.template(e("#js-builderius-panel-autosave-item-tmpl").html()),confirmTmpl:_.template(e("#js-builderius-confirm-action-tmpl").html()),events:{"click .uni-builder-panel-switch":"togglePanel","click .uni-builder-panel-blocks-section-title":"togglePanelBlocks","click #js-panel-style-switch":"styleSwitch","click #js-panel-position-switch":"positionSwitch","click #js-panel-save-changes":"saveContent","click #js-panel-delete-changes":"deleteContent","click #js-restore-autosaved":"autosaveRestore","click #js-panel-general-settings":"renderSettingsModal","click #js-panel-cpo-nov":"renderNovModal","click #js-panel-cpo-weight":"renderWeightModal","click #js-panel-cpo-shipping-class":"renderShippingClassModal","click #js-panel-cpo-dimensions":"renderDimensionsModal","click #js-panel-cpo-formula":"renderFormulaModal","click #js-panel-cpo-image-logic":"renderImageLogicModal","click #js-panel-cpo-cart-discounts":"renderDiscountsModal"},autosaveRestore:function(){const o=t._autosaveGetData();o&&(t.rowsCol.reset(),e(t._builderId).empty(),t.rowsCol.add(JSON.parse(o.content),{parse:!0}),t._updateListOfVars(),t._initSortables(),t._ifEmptyItem())},deleteContent:function(){if(t._ajax_sent)return;const o=this.confirmTmpl({data:{type:"error",message:"Are you sure?"}});this.$el.append(o);const i=e("#js-confirm-action-wrapper");i.fadeIn(200),e(document).on("click","#js-modal-cancel-btn",(function(){i.fadeOut(200,(function(){e(this).remove()}))})),e(document).on("click","#js-modal-delete-btn",(function(){const o={action:"uni_cpo_save_content",security:builderiusCfg.security,product_id:builderiusCfg.product.id};e.ajax({url:builderiusCfg.ajax_url,data:o,dataType:"json",method:"POST",beforeSend:function(){t._ajax_sent=!0,t._blockForm(i)},error:function(o){t._unblockForm(i,"error"),setTimeout((function(){i.fadeOut(200,(function(){e(this).remove()}))}),2e3),t._showMessage(o.statusText,"error"),console.info(o.status,o.statusText),t._ajax_sent=!1},success:function(o){o.success?(t.rowsCol.reset(),e(t._builderId).empty(),t._updateListOfVars(),t._initSortables(),t._ifEmptyItem(),t._removeWarningClass(),t._unblockForm(i,"success"),setTimeout((function(){i.fadeOut(200,(function(){e(this).remove()}))}),2e3),t._ajax_sent=!1):(t._unblockForm(i,"error"),void 0!==o.data.error&&(t._showMessage(o.data.error,"error"),console.log(o.data.error)))}})}))},initialize:function(){this.listenTo(this.collection,"change:autosaveData",this.renderAutosaveHtml)},positionSwitch:function(){const o=e("#uni-builder-panel");o.hasClass("uni-panel-left")?(o.removeClass("uni-panel-left").addClass("uni-panel-right"),t._initTooltip(e("#uni-builder-panel"),"right bottom","right top-10")):(o.removeClass("uni-panel-right").addClass("uni-panel-left"),t._initTooltip(e("#uni-builder-panel"),"left bottom","left top-10"))},render:function(){const e=this.template({autosaveData:this.model.get("autosaveData"),autosaveItemTmpl:this.autosaveTmpl,modules:builderiusModules,uri:this.model.get("uri")});this.$el.append(e)},renderAutosaveHtml:function(){const e=this.$el.find("#js-autosave-item"),t=this.model.get("autosaveData"),o=this.autosaveTmpl({data:t});e.replaceWith(o)},renderDiscountsModal:function(){new t.Views.CartDiscountsModal({model:this.model}).render()},renderFormulaModal:function(){new t.Views.MainFormulaModal({model:this.model}).render()},renderImageLogicModal:function(){new t.Views.ImageLogicModal({model:this.model}).render()},renderNovModal:function(){new t.Views.NovModal({model:this.model}).render()},renderSettingsModal:function(){new t.Views.GeneralSettingsModal({model:this.model}).render()},renderWeightModal:function(){new t.Views.WeightModal({model:this.model}).render()},renderShippingClassModal:function(){new t.Views.ShippingClassModal({model:this.model}).render()},renderDimensionsModal:function(){new t.Views.DimensionsModal({model:this.model}).render()},saveContent:function(){const o=t.rowsCol,i=JSON.stringify(o.toJSON());if(!o.toJSON().length||t._ajax_sent)return;const n={action:"uni_cpo_save_content",security:builderiusCfg.security,product_id:builderiusCfg.product.id,data:i};e.ajax({url:builderiusCfg.ajax_url,data:n,dataType:"json",method:"POST",beforeSend:function(){t._ajax_sent=!0,t._blockForm(".uni-builderius-container")},error:function(e){t._ajax_sent=!1,t._unblockForm(".uni-builderius-container","error"),t._showMessage(e.statusText,"error"),console.info(e.status,e.statusText)},success:function(e){e.success?(t._ajax_sent=!1,t._unblockForm(".uni-builderius-container","success"),t._removeWarningClass()):(t._unblockForm(".uni-builderius-container","error"),void 0!==e.data&&(t._showMessage(e.data.error,"warning"),console.log(e.data.error)))}})},styleSwitch:function(){const t=e("#uni-builder-panel");t.hasClass("uni-panel-light")?t.removeClass("uni-panel-light").addClass("uni-panel-dark"):t.removeClass("uni-panel-dark").addClass("uni-panel-light")},togglePanel:function(){!0===t._panel_on?t.closePanel():t.showPanel()},togglePanelBlocks:function(t){const o=e(t.target).closest(".uni-builder-panel-blocks-section");o.hasClass("active")?(o.removeClass("active").find(".fa-chevron-up").removeClass("fa-chevron-up").addClass("fa-chevron-down"),o.find(".uni-builder-panel-items").jScrollPane().data().jsp.destroy()):(o.addClass("active").find(".fa-chevron-down").removeClass("fa-chevron-down").addClass("fa-chevron-up"),o.find(".uni-builder-panel-items").jScrollPane({mouseWheelSpeed:40}))}}),t.Views.Builder=Backbone.View.extend({el:t._builderId,events:{"mouseenter .uni-row, .uni-col, .uni-module":"showOverlay","mouseleave .uni-row, .uni-col, .uni-module":"hideOverlay","mouseenter .uni-block-overlay-header":"showActionsBtns","mouseleave .uni-block-overlay-header":"hideActionsBtns"},row_overlay_tmpl:_.template(e("#js-builderius-row-overlay-tmpl").html()),col_overlay_tmpl:_.template(e("#js-builderius-col-overlay-tmpl").html()),module_overlay_tmpl:_.template(e("#js-builderius-module-overlay-tmpl").html()),createCol:function(e){const{order:o,obj_type:i,parentRowId:n,pid:a,type:s}=e,l=builderiusModules.module[s],r=this.collection.get(n),c={order:o,obj_type:i,parentRowId:n,pid:a,settings:window[l.cfg].settings,title:l.title,type:s},d=new t.Models.Column(c,{parse:!0});r.columns.add(d,{at:o}),this.updateOrder(r.columns),t._autosave()},createModule:function(e){const{order:o,obj_type:i,parentColumnId:n,parentRowId:a,pid:s,type:l}=e,r=builderiusModules[i][l],c={order:o,obj_type:i,parentColumnId:n,parentRowId:a,pid:s,settings:window[r.cfg].settings,title:r.title,type:l},d=new t.Models.Module(c,{parse:!0}),u=this.collection.get(a).columns.get(n);u.modules.add(d,{at:o}),this.updateOrder(u.modules),t._autosave()},createRowAndCol:function(e){const{order:o,obj_type:i,pid:n,type:a}=e,s=builderiusModules.module[a],l={order:o,obj_type:i,pid:n,settings:window[s.cfg].settings,title:s.title,type:a},r=new t.Models.Row(l,{parse:!0}),c=builderiusModules.module.column,d={order:0,obj_type:i,parentRowId:r.get("id"),pid:0,settings:window[c.cfg].settings,title:c.title,type:"column"},u=new t.Models.Column(d,{parse:!0});r.columns.add(u),this.collection.add(r,{at:o}),this.updateOrder(this.collection),t._autosave()},hideActionsBtns:function(o){if(!1===t._dragging){const t=e(o.currentTarget);t.parent().hasClass("uni-row-overlay")?t.parent().css({"z-index":999990}):t.parent().hasClass("uni-col-overlay")&&t.parent().css({"z-index":999991})}},hideOverlay:function(t){const o=e(t.currentTarget),i=o.data("type");"row"===i?o.removeClass("uni-row-overlay-active uni-row-small uni-row-overlay-muted").find(".uni-row-overlay").remove():"column"===i?(o.removeClass("uni-col-overlay-active uni-column-small uni-column-has-modules").find(".uni-col-overlay").remove(),o.closest(".uni-row").removeClass("uni-row-overlay-muted")):(o.removeClass("uni-module-overlay-active uni-module-small").find(".uni-module-overlay").remove(),o.closest(".uni-col").removeClass("uni-col-overlay-muted"))},initialize:function(){this.collection=t.rowsCol,this.rowsView=new t.Views.Rows({collection:this.collection})},moveCol:function(e){const{id:o,newParentRowId:i,order:n,parentRowId:a}=e,s=this.collection.get(a),l=this.collection.get(i),r=s.columns.get(o),c=r.duplicate(),d=c.get("id");c.set({order:n,parentRowId:i},{silent:!0}),r.modules.each((function(e){const t=e.duplicate();t.set({parentRowId:i,parentColumnId:d},{silent:!0}),c.modules.add(t)})),l.columns.add(c,{at:n}),this.updateOrder(l.columns),s.columns.remove(o),this.updateOrder(s.columns),t._autosave()},moveModule:function(e){const{id:o,newParentColumnId:i,newParentRowId:n,order:a,parentColumnId:s,parentRowId:l}=e,r=this.collection.get(l),c=this.collection.get(n),d=r.columns.get(s),u=c.columns.get(i),m=d.modules.get(o).duplicate();m.set({order:a,parentColumnId:i,parentRowId:n},{silent:!0}),u.modules.add(m,{at:a}),this.updateOrder(u.modules),d.modules.remove(o),this.updateOrder(d.modules),t._autosave()},render:function(){return this.$el.html(this.rowsView.render().$el),this},renderColOverlay:function(e){const t=this,o=e;if(!o.hasClass("uni-col-overlay-active")){o.width()<194&&o.addClass("uni-column-small"),o.find(".uni-module").length>0&&o.addClass("uni-column-has-modules");const e=t.col_overlay_tmpl();o.append(e).addClass("uni-col-overlay-active"),o.closest(".uni-row").addClass("uni-row-overlay-muted")}},renderModuleOverlay:function(e){const t=this,o=e;if(!o.hasClass("uni-module-overlay-active")){o.width()<194&&o.addClass("uni-module-small");const e=t.module_overlay_tmpl();o.append(e).addClass("uni-module-overlay-active"),o.closest(".uni-col").addClass("uni-col-overlay-muted")}},renderRowOverlay:function(e){const t=this,o=e;if(!o.hasClass("uni-row-overlay-active")){o.width()<174&&o.addClass("uni-row-small");const e=t.row_overlay_tmpl();o.append(e).addClass("uni-row-overlay-active")}},showActionsBtns:function(o){if(!1===t._dragging){const t=e(o.currentTarget);t.parent().hasClass("uni-row-overlay")?t.parent().css({"z-index":999993}):t.parent().hasClass("uni-col-overlay")&&t.parent().css({"z-index":999994})}},showOverlay:function(o){if(o.stopPropagation(),!1===t._dragging){const t=this,i=e(o.currentTarget),n=i.attr("data-type");if("row"===n)t.renderRowOverlay(i);else if("column"===n){const e=i.closest(".uni-row");t.renderColOverlay(i),t.renderRowOverlay(e)}else{const e=i.closest(".uni-col"),o=i.closest(".uni-row");t.renderModuleOverlay(i),t.renderColOverlay(e),t.renderRowOverlay(o)}}},updateOrder:function(e){let t=0;e.each((e=>{e.set({order:t}),t++}))}}),t.Views.Rows=Backbone.View.extend({destroyed:function(){this.updateOrder(this.collection)},initialize:function(){this.listenTo(this.collection,"add",this.insertRow),this.listenTo(this.collection,"destroy",this.destroyed),this.listenTo(this.collection,"remove",this.removedRow),this.listenTo(this.collection,"sort",this.sorted),this.listenTo(this.collection,"update",this.render),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"change:settings",this.render)},insertRow:function(o){const i=new t.Views.Row({model:o}),n=parseInt(o.get("order"));0===n?this.$el.prepend(i.render().$el):n>0&&i.render().$el.insertAfter(e(t._builderId+" .uni-row:eq("+(n-1)+")"))},removedRow:function(e){},render:function(){return this.collection.models.length>0?e(t._builderId).removeClass("uni-empty-container"):e(t._builderId).addClass("uni-empty-container"),this.collection.sort().each(this.renderRow,this),this.setElement(e(t._builderId)),t._initSortables(),t._ifEmptyItem(),this},renderRow:function(e){const o=new t.Views.Row({model:e}),i=this.$el.find("[data-node="+e.get("id")+"]");i.length>0?i.replaceWith(o.render().$el):this.$el.append(o.render().$el)},sorted:function(){},updateOrder:function(e){let t=0;e.each((e=>{e.set({order:t}),t++}))}}),t.Views.Row=Backbone.View.extend({events:{"click .js-uni-row-settings":"openSettingsModal","click .js-uni-row-clone":"duplicateItem","click .js-uni-row-remove":"removeItem","click .uni-block-overlay-title":"showActionsBtns"},template:_.template(e("#js-builderius-row-tmpl").html()),duplicateItem:function(){const e=this.model.collection.max((e=>e.get("order"))).get("order")+1,o=this.model.duplicate(),i=o.get("id");o.set({order:e},{silent:!0}),this.model.columns.each((function(e){const t=e.duplicate();t.set({parentRowId:i},{silent:!0}),e.modules.each((function(e){const o=e.duplicate();o.set({parentRowId:i,parentColumnId:t.get("id"),pid:null},{silent:!0}),t.modules.add(o)})),o.columns.add(t)})),this.model.collection.add(o,{at:e}),this.updateOrder(this.model.collection),t._initSortables(),t._ifEmptyItem()},initialize:function(){},openSettingsModal:function(){new t.Views.Modal({model:this.model}).render()},removeItem:function(){const e=this.model;_.isEmpty(e.columns.models)||(_.each(e.columns.models,(function(e){_.isEmpty(e.modules.models)||e.modules.remove(e.modules.models)})),e.columns.remove(e.columns.models)),e.destroy(),this.remove(),t._updateListOfVars(),t._initSortables(),t._ifEmptyItem(),t._addWarningClass()},render:function(){const e=this.template(this.model.toJSON()),o=this.model.columns;return this.setElement(e),this.columnsView=new t.Views.Columns({collection:o}),this.columnsView.setElement(this.$("#js-row-group-"+this.model.get("id"))).render(),this},showActionsBtns:function(t){const o=e(t.target),i="uni-clicked";o.hasClass(i)?o.removeClass(i):o.addClass(i)},updateOrder:function(e){let t=0;e.each((e=>{e.set({order:t}),t++}))}}),t.Views.Columns=Backbone.View.extend({destroyed:function(){this.updateOrder(this.collection)},initialize:function(){this.listenTo(this.collection,"add",this.insertColumn),this.listenTo(this.collection,"destroy",this.destroyed),this.listenTo(this.collection,"remove",this.removedCol),this.listenTo(this.collection,"update",this.render),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"change:settings",this.render)},insertColumn:function(e){const o=new t.Views.Column({model:e}),i=parseInt(e.get("order"));0===i?this.$el.prepend(o.render().$el):i>0&&o.render().$el.insertAfter(this.$el.find(".uni-col:eq("+(i-1)+")"))},removedCol:function(e){},render:function(){return this.collection.sort().each(this.renderColumn,this),t._initSortables(),t._ifEmptyItem(),this},renderColumn:function(e){const o=new t.Views.Column({model:e}),i=this.$el.find("[data-node="+e.get("id")+"]");i.length>0?i.replaceWith(o.render().$el):this.$el.append(o.render().$el)},updateOrder:function(e){let t=0;e.each((e=>{e.set({order:t}),t++}))}}),t.Views.Column=Backbone.View.extend({events:{"click .js-uni-column-settings":"openSettingsModal","click .js-uni-column-clone":"duplicateItem","click .js-uni-column-remove":"removeItem"},template:_.template(e("#js-builderius-col-tmpl").html()),duplicateItem:function(){const e=this.model.collection.max((e=>e.get("order"))).get("order")+1,o=this.model.duplicate(),i=o.get("id");o.set({order:e},{silent:!0});const n=this.model.get("parentRowId"),a=t.rowsCol.get(n);this.model.modules.each((function(e){const t=e.duplicate();t.set({parentRowId:n,parentColumnId:i,pid:null},{silent:!0}),o.modules.add(t)})),a.columns.add(o,{at:e}),this.updateOrder(this.model.collection),t._initSortables(),t._ifEmptyItem()},initialize:function(){},openSettingsModal:function(){new t.Views.Modal({model:this.model}).render()},removeItem:function(){const e=this.model;_.isEmpty(e.modules)||e.modules.remove(e.modules.models),e.destroy(),this.remove(),t._updateListOfVars(),t._initSortables(),t._ifEmptyItem(),t._addWarningClass()},render:function(){const e=this.template(this.model.toJSON()),o=this.model.modules;return this.setElement(e),this.modulesView=new t.Views.Modules({collection:o}),this.modulesView.setElement(this.$("#js-col-group-"+this.model.get("id"))).render(),this},updateOrder:function(e){let t=0;e.each((e=>{e.set({order:t}),t++}))}}),t.Views.Modules=Backbone.View.extend({destroyed:function(){this.updateOrder(this.collection)},initialize:function(){this.listenTo(this.collection,"add",this.insertModule),this.listenTo(this.collection,"change:settings",this.render),this.listenTo(this.collection,"destroy",this.destroyed),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"remove",this.removedModule)},insertModule:function(e){const o=new t.Views.Module({model:e}),i=parseInt(e.get("order"));0===i?this.$el.prepend(o.render().$el):i>0&&o.render().$el.insertAfter(this.$el.find(".uni-module:eq("+(i-1)+")"))},removedModule:function(e){},render:function(){return this.collection.sort().each(this.renderModule,this),this},renderModule:function(e){const o=new t.Views.Module({model:e}),i=this.$el.find("[data-node="+e.get("id")+"]");i.length>0?i.replaceWith(o.render().$el):this.$el.append(o.render().$el)},updateOrder:function(e){let t=0;e.each((e=>{e.set({order:t}),t++}))}}),t.Views.Module=Backbone.View.extend({events:{"click .js-uni-module-settings":"openSettingsModal","click .js-uni-module-clone":"duplicateItem","click .js-uni-module-remove":"removeItem"},duplicateItem:function(){const e=this.model.collection.max((e=>e.get("order"))).get("order")+1,o=this.model.duplicate(),i=this.model.get("parentColumnId"),n=this.model.get("parentRowId");o.set({order:e,pid:null},{silent:!0}),t.rowsCol.get(n).columns.get(i).modules.add(o,{at:e}),this.updateOrder(this.model.collection),t._initSortables(),t._ifEmptyItem()},initialize:function(){const t="#js-builderius-module-"+this.model.get("type")+"-tmpl";this.template=_.template(e(t).html(),{variable:"data"})},openSettingsModal:function(){new t.Views.Modal({model:this.model}).render()},removeItem:function(){this.model.destroy(),this.remove(),t._updateListOfVars(),t._initSortables(),t._ifEmptyItem(),t._addWarningClass()},render:function(){const e=this.template(this.model.toJSON());if(this.setElement(e),"range_slider"===this.model.get("type")){const e=this.$el.find(".js-uni-cpo-field-range_slider");t._initRangeSlider(e)}return this.model.get("type"),this},updateOrder:function(e){let t=0;e.each((e=>{e.set({order:t}),t++}))}}),t.Views.Modal=Backbone.View.extend({el:"body",events:{"click .uni-close-modal":"closeModal","click #js-modal-cancel-btn":"closeModal","click #js-modal-save-btn":"saveSettings",'change [data-uni-constrainer="yes"]':"updateConstrained","click #js-fetch-similar-modules":"fetchModules","change .js-sync-methods":"settingSyncMethodChanged","change .js-sync-posts":"settingSyncPostChanged","click #js-sync-module-btn":"syncWithModule","click .uni-rules-remove-all":"removeAllRules","click #js-unsync-module-btn":"unSyncModule","focus #builderius-setting-cpo_notice_text":"getFocused","click .uni-matrix-import-btn":"importMatrixCsv"},template:_.template(e("#js-builderius-modal-tmpl").html()),template_tab_list:_.template(e("#js-builderius-modal-tab-list-tmpl").html()),template_tab_open:_.template(e("#js-builderius-modal-tab-open-tmpl").html()),template_tab_close:_.template(e("#js-builderius-modal-tab-close-tmpl").html()),template_group_open:_.template(e("#js-builderius-modal-group-open-tmpl").html()),template_group_close:_.template(e("#js-builderius-modal-group-close-tmpl").html()),ajaxError:function(e){this.model.set({settings:this.originalModelSettings}),t._unblockForm("#js-block-settings-modal","error"),console.info(e.status,e.statusText)},ajaxSent:function(){t._blockForm("#js-block-settings-modal");const o=e("#js-cpo-field-slug-wrapper");o.removeClass("uni-error-label"),o.parent().find(".uni-slug-suggestion").remove()},ajaxSynced:function(o){const i=this;if(o.success){i.model.set(o.data),t._updateListOfVars(),t._autosave(),e(".ui-tabs .ui-tabs-nav li.uni-warning").removeClass("uni-warning"),e("#js-modal-save-btn").removeClass("uni-active"),e(".uni-slug-suggestion").remove();const n=e("#builderius-setting-cpo_slug"),a=o.data?.pid;console.log("data",o.data,a),a&&n&&n.attr("disabled",!0),t._unblockForm("#js-block-settings-modal","success")}else{if(i.model.set({settings:i.originalModelSettings}),o.data.errorData)void 0!==o.data.errorData.unique&&!o.data.errorData.unique&&o.data.errorData.slug&&i.displaySuggestion(o.data.errorData.slug);else{e("#js-cpo-field-slug-wrapper").addClass("uni-error-label"),void 0!==o.data.error&&console.log(o.data.error)}t._unblockForm("#js-block-settings-modal","error")}},closeModal:function(){this.$el.find("#uni-modal-wrapper").remove(),this.undelegateEvents(),this.stopListening(),t._modal_on=!1,t._option_slug=null},displaySuggestion:function(t){e(".uni-slug-suggestion").length&&e(".uni-slug-suggestion").remove();const o=e(".uni-modal-row-slug-wrap"),i=e("#js-cpo-field-slug-wrapper"),n=e("<div></div>");i.addClass("uni-error-label"),o.prepend(n),n.addClass("uni-slug-suggestion").html(builderius_i18n.modal.suggestion+":<span>"+t+"</span>")},fetchModules:function(o){const i=this,n=e(".js-sync-posts"),a=e("#js-sync-module-btn"),s={action:"uni_cpo_fetch_similar_modules",security:builderiusCfg.security,pid:i.model.get("pid"),type:i.model.get("type"),obj_type:i.model.get("obj_type")};e.ajax({url:builderiusCfg.ajax_url,data:s,dataType:"json",method:"POST",beforeSend:function(){t._blockForm("#js-block-settings-modal");const o=e('<option value="0">- None -</option>');n.empty().append(o),e(".uni-fetch-wrap").removeClass("uni-active"),a.hide()},error:function(e){t._unblockForm("#js-block-settings-modal","error"),t._showMessage(e.statusText,"error"),console.info(e.status,e.statusText)},success:function(o){o.success?(n.empty(),_.each(o.data,(function(t,o){const i=e(`<option value="${o}">${t}</option>`);n.append(i)})),"none"!==i.settingSyncMethodState&&(e(".uni-fetch-wrap").addClass("uni-active"),a.show()),t._unblockForm("#js-block-settings-modal","success")):(e(".uni-fetch-wrap").removeClass("uni-active"),a.hide(),t._unblockForm("#js-block-settings-modal","error"),void 0!==o.data.error&&(t._showMessage(o.data.error,"error"),console.log(o.data.error)))}})},generateMatrixTable:function(o){const i=e("#uni-matrix-option-table-container").attr("id"),n=e(".uni-matrix-option-json"),a=[],s=[];if(void 0===o){const t=e(".uni-matrix-option-data-in-col").val().split("|"),o=e(".uni-matrix-option-data-in-row").val().split("|");if(a.push({name:"rows",label:"",datatype:"string",editable:!1}),t.forEach((function(e,t){a.push({name:e,label:e,datatype:"double(4)",editable:!0})})),a.push({name:"action",label:"Action",datatype:"html",editable:!1,values:null}),""!==n.val()){const e=JSON.parse(n.val());o.forEach((function(t,o){const i=[];for(var n=0;n<a.length;n++)i.push(0);let l;i[0]=t,void 0!==e[o]?(e[o].columns[0]=t,l=e[o].columns):l=i,s.push({id:o,values:l})}))}else o.forEach((function(e,t){const o=[];for(var i=0;i<a.length;i++)o.push(0);o[0]=e,s.push({id:t,values:o})}))}else o.metadata.forEach((function(e,t){a.push({name:e,label:e,datatype:"double(4)",editable:!0})})),a.push({name:"action",label:"Action",datatype:"html",editable:!1,values:null}),o.data.forEach((function(e){s.push({id:e.id,values:e.columns})}));this.matrixTable=new EditableGrid("matrixTable",{enableSort:!1,editmode:"absolute",rowRemoved:function(o,n){const a=e(".uni-matrix-option-data-in-row").val().split("|");a.splice(n,1),e(".uni-matrix-option-data-in-row").val(a.join("|")),t._destroyScroll(i),t._initScroll(i)},duplicate:function(o){const n=this.getRowValues(o);n.name=n.name+" (copy)";for(var a=0,s=0;s<this.getRowCount();s++)a=Math.max(a,parseInt(this.getRowId(s))+1);t._destroyScroll(i);const l=e(".uni-matrix-option-data-in-row").val().split("|");l.splice(o,0,n.rows),e(".uni-matrix-option-data-in-row").val(l.join("|")),this.insertAfter(o,a,n),t._initScroll(i)},tableRendered:function(e,t,o){const i=JSON.stringify(this.data);n.val(i)},modelChanged:function(e,t,o,i,a){const s=JSON.stringify(this.data);n.val(s)}}),this.matrixTable.load({metadata:a,data:s}),this.matrixTable.setCellRenderer("action",new CellRenderer({render:function(e,t){e.innerHTML='<a class="uni-generated-table-remove-row" data-row="'+e.rowIndex+'" style="cursor:pointer"><i class="fas fa-trash" alt="delete" title="Delete row"></i></a>',e.innerHTML+='&nbsp;<a class="uni-generated-table-clone-row" data-row="'+e.rowIndex+'" style="cursor:pointer"><i class="fas fa-copy" border="0" alt="duplicate" title="Duplicate row"></i></a>'}})),this.matrixTable.renderGrid(i,"uni-generated-table","js-generated-table"),t._initScroll(i),e(".uni-matrix-generate-btn").removeClass("uni-active")},getFocused:function(t){this.textarea=e(t.currentTarget)},importMatrixCsv:function(o){o.preventDefault();const i=this,n=e(o.target),a=n.closest(".uni-cpo-matrix-options-wrap"),s=a.find(".uni-matrix-table-container").attr("id"),l=(n.data("row"),n.prevAll("input[type=file]")[0].files[0]),r=new FormData;if(void 0!==l){const o={action:"uni_cpo_import_matrix",security:builderiusCfg.security};r.append("file",l),e.each(o,(function(e,t){r.append(e,t)})),e.ajax({url:builderiusCfg.ajax_url,data:r,method:"POST",processData:!1,contentType:!1,beforeSend:function(){t._blockForm("#uni-modal-wrap")},error:function(e){t._unblockForm("#uni-modal-wrap","error"),t._showMessage(e.statusText,"error"),console.info(e.status,e.statusText)},success:function(e){if(e.success){const o=a.find(".uni-matrix-data");let n=e.data.metadata;n.shift(),n=n.join("|"),o.val(n),t._destroyScroll(s),i.generateTable(a,e.data),t._unblockForm("#uni-modal-wrap","success")}else t._unblockForm("#uni-modal-wrap","error"),void 0!==e.data.error&&(t._showMessage(e.data.error,"error"),console.log(e.data.error))}})}},initialize:function(){const t=this;t.settingTmpls={},t.originalModelSettings={},t.settingSyncMethodState="none",e.each(builderiusSettings,(function(o,i){const n=e("#js-builderius-setting-"+i+"-tmpl");n.length>0&&(t.settingTmpls[i]=_.template(n.html(),{variable:"data"}))})),this.listenTo(this.model,"request",this.ajaxSent)},readSettings:function(){const o=this.$el.find(".uni-tab-content"),i={data:{},valid:!0};return o.each((function(){const o=e(this),n=o.data("section"),a=o.find("> div");i.data[n]={},a.each((function(){const o=e(this),a=o.data("group"),s=o.find(".builderius-setting-field");i.data[n][a]={},s.each((function(){const o=this.type||this.tagName.toLowerCase(),s=e(this),l=s.parsley();let r=s.attr("name");if(l.validate(),l.isValid()){const l=t._parseNameWithBrackets(r);if(l.matches&&(void 0===i.data[n][a][l.name]&&(i.data[n][a][l.name]={}),void 0===i.data[n][a][l.name][l.matches[0]]&&void 0!==l.matches[0]&&(i.data[n][a][l.name][l.matches[0]]={}),void 0===i.data[n][a][l.name][l.matches[0]][l.matches[1]]&&void 0!==l.matches[1]&&(i.data[n][a][l.name][l.matches[0]][l.matches[1]]={})),"checkbox"===o)if(s.hasClass("builderius-single-checkbox"))l.matches?void 0!==l.matches[0]&&void 0!==l.matches[1]?s.is(":checked")?i.data[n][a][l.name][l.matches[0]][l.matches[1]]=s.val():i.data[n][a][l.name][l.matches[0]][l.matches[1]]="off":void 0!==l.matches[0]&&void 0===l.matches[1]&&(s.is(":checked")?i.data[n][a][l.name][l.matches[0]]=s.val():i.data[n][a][l.name][l.matches[0]]="off"):s.is(":checked")?i.data[n][a][r]=s.val():i.data[n][a][r]="off";else if(l.matches){const t=[];void 0!==l.matches[0]&&void 0!==l.matches[1]?(e('input[name="'+this.name+'"]:checked').each((function(){t.push(e(this).val())})),i.data[n][a][l.name][l.matches[0]][l.matches[1]]=t):void 0!==l.matches[0]&&void 0===l.matches[1]&&(e('input[name="'+this.name+'"]:checked').each((function(){t.push(e(this).val())})),i.data[n][a][l.name][l.matches[0]]=t)}else{const t=[],o=this.name.slice(0,-2);e('input[name="'+this.name+'"]:checked').each((function(){t.push(e(this).val())})),i.data[n][a][o]=t}else"radio"===o?l.matches?void 0!==l.matches[0]&&void 0!==l.matches[1]?s.is(":checked")?i.data[n][a][l.name][l.matches[0]][l.matches[1]]=s.val():s.hasClass("uni-cpo-deselectable-input")&&(i.data[n][a][l.name][l.matches[0]][l.matches[1]]=""):void 0!==l.matches[0]&&void 0===l.matches[1]&&(s.is(":checked")?i.data[n][a][l.name][l.matches[0]]=s.val():s.hasClass("uni-cpo-deselectable-input")&&(i.data[n][a][l.name][l.matches[0]]="")):s.is(":checked")?i.data[n][a][r]=s.val():s.hasClass("uni-cpo-deselectable-input")&&(i.data[n][a][r]=""):l.matches?void 0!==l.matches[1]?i.data[n][a][l.name][l.matches[0]][l.matches[1]]=s.val():i.data[n][a][l.name][l.matches[0]]=s.val():i.data[n][a][r]=s.val()}else i.valid=!1}))}))})),i},removeAllRules:function(){e(".uni-formula-conditional-rules-options-row").not(".uni-formula-conditional-rules-options-template").remove(),e(".uni_formula_conditional_rule_add").click()},render:function(){const o=this;if(t._modal_on=!0,"option"===o.model.get("obj_type")){const e=o.model.get("settings");t._option_slug=e.cpo_general.main.cpo_slug||null}const i=o.template({model_data:o.model.toJSON(),template_tab_list:o.template_tab_list,template_tab_open:o.template_tab_open,template_tab_close:o.template_tab_close,template_group_open:o.template_group_open,template_group_close:o.template_group_close,settingTmpls:o.settingTmpls});o.$el.append(i),this.updateConstrained(),t._linkedFields();const n=o.$el.find(".uni-custom-select-wrap");return t._generateCustomSelectHtml(n),e(document.body).trigger("builderius_module_settings_modal_opening",[o]),this},saveSettings:function(){const o=this,i=o.model.get("type"),n=o.model.get("obj_type"),a=JSON.parse(JSON.stringify(this.model.get("settings"))),s=o.readSettings(),l="yes"===e("#js-save-to-db").val();if(s.valid&&!t._ajax_sent){const r=e.extend(!0,{},a,s.data),c=builderiusModules[n][i];if(_.each(o.model.get("settings"),(function(e,t){(_.isEmpty(s.data[t])||void 0!==s.data[t].data&&_.isEmpty(s.data[t].data))&&!_.isEmpty(window[c.cfg].settings[t])&&(r[t]=window[c.cfg].settings[t])})),r.cpo_suboptions=s.data.cpo_suboptions,void 0!==s.data.cpo_rules&&(r.cpo_rules=s.data.cpo_rules),void 0!==s.data.cpo_validation&&void 0!==s.data.cpo_validation.logic?void 0!==s.data.cpo_validation.logic.cpo_vc_scheme?r.cpo_validation.logic.cpo_vc_scheme=s.data.cpo_validation.logic.cpo_vc_scheme:r.cpo_validation.logic.cpo_vc_scheme=[]:void 0!==s.data.cpo_validation&&void 0===s.data.cpo_validation.logic&&(r.cpo_validation.logic={}),l){const e={action:"uni_cpo_save_model",security:builderiusCfg.security,product_id:builderiusCfg.product.id,success:function(e){o.ajaxSynced(e)},error:function(e){o.ajaxError(e)}};o.originalModelSettings=a,o.model.set({settings:r}),o.model.sync("create",o.model,e)}else o.model.set({settings:r}),t._autosave();t._addWarningClass(),e("#js-modal-save-btn").removeClass("uni-active")}},settingSyncMethodChanged:function(){const t=this,o=e(".js-sync-methods"),i=e(".js-sync-posts"),n=e("#js-sync-module-btn");o.each((function(){const o=e(this);o.is(":checked")&&(t.settingSyncMethodState=o.val())})),"none"!==t.settingSyncMethodState&&i.val()?(e(".uni-fetch-wrap").addClass("uni-active"),n.show()):(e(".uni-fetch-wrap").removeClass("uni-active"),n.hide())},settingSyncPostChanged:function(t){const o=e(t.target),i=e("#js-sync-module-btn");"none"!==this.settingSyncMethodState&&o.val()?(e(".uni-fetch-wrap").addClass("uni-active"),i.show()):(e(".uni-fetch-wrap").removeClass("uni-active"),i.hide())},syncWithModule:function(){const o=this,i=e(".js-sync-posts"),n={action:"uni_cpo_sync_with_module",security:builderiusCfg.security,pid:i.val(),method:o.settingSyncMethodState,obj_type:o.model.get("obj_type")};e.ajax({url:builderiusCfg.ajax_url,data:n,dataType:"json",method:"POST",beforeSend:function(){t._blockForm("#js-block-settings-modal")},error:function(e){t._unblockForm("#js-block-settings-modal","error"),t._showMessage(e.statusText,"error"),console.info(e.status,e.statusText)},success:function(e){e.success?("connect"===o.settingSyncMethodState?o.model.set(e.data):"duplicate"===o.settingSyncMethodState&&o.model.set({settings:e.data.settings}),"option"===o.model.get("obj_type")&&t._updateListOfVars(),o.closeModal(),t._autosave(),t._unblockForm("#js-block-settings-modal","success"),t._addWarningClass()):(t._unblockForm("#js-block-settings-modal","error"),void 0!==e.data.error&&(t._showMessage(e.data.error,"error"),console.log(e.data.error)))}})},unSyncModule:function(){this.model.set({pid:null}),this.closeModal(),t._autosave(),t._addWarningClass()},updateConstrained:function(){t._conditionalFields()}}),t.Views.GeneralSettingsModal=Backbone.View.extend({el:"body",events:{"click .uni-close-modal":"closeModal","click #js-modal-main-cancel-btn":"closeModal","click #js-duplicate-product-btn":"duplicateProductSettings","click #js-modal-main-import-btn":"importProductSettings","click #js-modal-main-export-btn":"exportProductSettings","click #js-fetch-similar-products":"fetchProducts","click #js-modal-main-save-btn":"saveSettings"},template:_.template(e("#js-builderius-modal-general-settings-tmpl").html()),ajaxError:function(e){t._unblockForm("#uni-modal-general-settings-wrapper","error"),console.info(e.status,e.statusText)},ajaxSent:function(){t._blockForm("#uni-modal-general-settings-wrapper")},ajaxSynced:function(o){const i=this;o.success?(e("#js-modal-main-save-btn").removeClass("uni-active"),t._unblockForm("#uni-modal-general-settings-wrapper","success")):(i.model.set({settingsData:i.originalModelSettings}),t._unblockForm("#uni-modal-general-settings-wrapper","error"))},closeModal:function(){this.$el.find("#uni-modal-wrapper").remove(),this.undelegateEvents(),this.stopListening(),t._modal_on=!1},duplicateProductSettings:function(){const o=e(".js-sync-products"),i={action:"uni_cpo_duplicate_product_settings",security:builderiusCfg.security,pid:this.model.get("id"),target_id:o.val()};e.ajax({url:builderiusCfg.ajax_url,data:i,dataType:"json",method:"POST",beforeSend:function(){t._blockForm("#uni-modal-general-settings-wrapper")},error:function(e){t._unblockForm("#uni-modal-general-settings-wrapper","error"),t._showMessage(e.statusText,"error"),console.info(e.status,e.statusText)},success:function(e){e.success?location.reload():(t._unblockForm("#uni-modal-general-settings-wrapper","error"),void 0!==e.data.error&&(t._showMessage(e.data.error,"error"),console.log(e.data.error)))}})},exportProductSettings:function(){const o=e("#js-cpo-export-email").val();if(!o)return!1;const i={action:"uni_cpo_product_settings_export",security:builderiusCfg.security,pid:this.model.get("id"),email:o};e.ajax({url:builderiusCfg.ajax_url,data:i,dataType:"json",method:"POST",beforeSend:function(){t._blockForm("#uni-modal-general-settings-wrapper")},error:function(e){t._unblockForm("#uni-modal-general-settings-wrapper","error"),t._showMessage(e.statusText,"error"),console.info(e.status,e.statusText)},success:function(e){e.success?t._unblockForm("#uni-modal-general-settings-wrapper","success"):(t._unblockForm("#uni-modal-general-settings-wrapper","error"),void 0!==e.data.error&&(t._showMessage(e.data.error,"error"),console.log(e.data.error)))}})},fetchProducts:function(){const o=e(".js-sync-products"),i=e("#js-duplicate-product-btn"),n={action:"uni_cpo_fetch_similar_products",security:builderiusCfg.security,pid:this.model.get("id")};e.ajax({url:builderiusCfg.ajax_url,data:n,dataType:"json",method:"POST",beforeSend:function(){t._blockForm("#uni-modal-general-settings-wrapper");const n=e('<option value="0">'+builderius_i18n.none+"</option>");o.empty().append(n),i.hide()},error:function(e){t._unblockForm("#uni-modal-general-settings-wrapper","error"),t._showMessage(e.statusText,"error"),console.info(e.status,e.statusText)},success:function(n){n.success?(o.empty(),_.each(n.data,(function(t,i){const n=e(`<option value="${i}">${t}</option>`);o.append(n)})),i.show(),t._unblockForm("#uni-modal-general-settings-wrapper","success")):(i.hide(),t._unblockForm("#uni-modal-general-settings-wrapper","error"),void 0!==n.data.error&&(t._showMessage(n.data.error,"error"),console.log(n.data.error)))}})},importProductSettings:function(){const o=e("#js-cpo-import-file"),i=e("#js-cpo-import-preference-checkbox").is(":checked"),n=o[0].files[0],a=new FormData;if(void 0===n)return!1;const s={action:"uni_cpo_product_settings_import",security:builderiusCfg.security,is_remove_pid:i,pid:this.model.get("id")};a.append("file",n),e.each(s,(function(e,t){a.append(e,t)})),e.ajax({url:builderiusCfg.ajax_url,data:a,processData:!1,contentType:!1,method:"POST",beforeSend:function(){t._blockForm("#uni-modal-general-settings-wrapper")},error:function(e){t._unblockForm("#uni-modal-general-settings-wrapper","error"),t._showMessage(e.statusText,"error"),console.info(e.status,e.statusText)},success:function(e){e.success?location.reload():(t._unblockForm("#uni-modal-general-settings-wrapper","error"),void 0!==e.data.error&&(t._showMessage(e.data.error,"error"),console.log(e.data.error)))}})},initialize:function(){this.originalModelSettings={},this.listenTo(this.model,"request",this.ajaxSent)},render:function(){const o=this;t._modal_on=!0;const i=o.template({data:o.model.get("settingsData"),vars:t._optionVars});return this.$el.append(i),e(document.body).trigger("builderius_general_settings_modal_opening",[o]),this},saveSettings:function(){const e=this,o=t._readSettingsModal(e),i=JSON.parse(JSON.stringify(e.model.get("settingsData")));if(o.valid&&!t._ajax_sent){const t=o.data,n={action:"uni_cpo_save_settings_data",security:builderiusCfg.security,success:function(t){e.ajaxSynced(t)},error:function(t){e.ajaxError(t)}};e.originalModelSettings=i,e.model.set({settingsData:t}),e.model.sync("create",e.model,n)}}}),t.Views.CartDiscountsModal=Backbone.View.extend({el:"body",events:{"click .uni-close-modal":"closeModal","click #js-modal-main-cancel-btn":"closeModal","click #js-modal-main-save-btn":"saveSettings"},template:_.template(e("#js-builderius-modal-cart-discounts-tmpl").html()),ajaxError:function(e){t._unblockForm("#uni-modal-cart-discounts-wrapper","error"),console.info(e.status,e.statusText)},ajaxSent:function(){t._blockForm("#uni-modal-cart-discounts-wrapper")},ajaxSynced:function(o){const i=this;o.success?(e("#js-modal-main-save-btn").removeClass("uni-active"),t._unblockForm("#uni-modal-cart-discounts-wrapper","success")):(i.model.set({discountsData:i.originalModelSettings}),t._unblockForm("#uni-modal-cart-discounts-wrapper","error"))},closeModal:function(){this.$el.find("#uni-modal-wrapper").remove(),this.undelegateEvents(),this.stopListening(),t._modal_on=!1},initialize:function(){this.originalModelSettings={},this.listenTo(this.model,"request",this.ajaxSent)},render:function(){const o=this;t._modal_on=!0;const i=o.template({data:o.model.get("discountsData"),vars:t._optionVars});return this.$el.append(i),e(document.body).trigger("builderius_cart_discounts_modal_opening",[o]),this},saveSettings:function(){const e=this,o=t._readSettingsModal(e),i=JSON.parse(JSON.stringify(e.model.get("discountsData")));if(o.valid&&!t._ajax_sent){const t=o.data,n={action:"uni_cpo_save_discounts_data",security:builderiusCfg.security,success:function(t){e.ajaxSynced(t)},error:function(t){e.ajaxError(t)}};e.originalModelSettings=i,e.model.set({discountsData:t}),e.model.sync("create",e.model,n)}}}),t.Views.MainFormulaModal=Backbone.View.extend({el:"body",events:{"click .uni-close-modal":"closeModal","click #js-modal-main-cancel-btn":"closeModal","click .uni-rules-remove-all":"removeAllRules","click #js-modal-main-save-btn":"saveSettings","focus #uni-modal-main-formula-wrapper textarea":"getFocused"},template:_.template(e("#js-builderius-modal-main-tmpl").html()),ajaxError:function(e){t._unblockForm("#uni-modal-wrap","error"),console.info(e.status,e.statusText)},ajaxSent:function(e,o,i){t._blockForm("#uni-modal-wrap")},ajaxSynced:function(o){const i=this;o.success?(e("#js-modal-main-save-btn").removeClass("uni-active"),t._unblockForm("#uni-modal-wrap","success")):(i.model.set({formulaData:i.originalModelSettings}),t._unblockForm("#uni-modal-wrap","error"))},closeModal:function(){this.$el.find("#uni-modal-main-formula-wrapper").remove(),this.undelegateEvents(),this.stopListening(),t._modal_on=!1},getFocused:function(){const t=this;e(document).find("textarea.builderius-setting-field").on("focus",(function(){t.textarea=e(this)}))},initialize:function(){this.originalModelSettings={},this.listenTo(this.model,"request",this.ajaxSent)},removeAllRules:function(){e(".uni-formula-conditional-rules-options-row").not(".uni-formula-conditional-rules-options-template").remove(),e(".uni_formula_conditional_rule_add").click()},render:function(){const o=this;t._modal_on=!0;const i=o.template({data:o.model.get("formulaData"),vars:t._optionVars});return this.$el.append(i),e(document.body).trigger("builderius_main_formula_modal_opening",[o]),this},saveSettings:function(){const e=this,o=t._readSettingsModal(e),i=JSON.parse(JSON.stringify(e.model.get("formulaData")));if(o.valid&&!t._ajax_sent){const t=o.data,n={action:"uni_cpo_save_formula_data",security:builderiusCfg.security,success:function(t){e.ajaxSynced(t)},error:function(t){e.ajaxError(t)}};e.originalModelSettings=i,e.model.set({formulaData:t}),e.model.sync("create",e.model,n)}}}),t.Views.ImageLogicModal=Backbone.View.extend({el:"body",events:{"click .uni-close-modal":"closeModal","click #js-modal-main-cancel-btn":"closeModal","click .uni-rules-remove-all":"removeAllRules","click #js-modal-main-save-btn":"saveSettings"},template:_.template(e("#js-builderius-modal-image-logic-tmpl").html()),ajaxError:function(e){t._unblockForm("#uni-modal-wrap","error"),console.info(e.status,e.statusText)},ajaxSent:function(e,o,i){t._blockForm("#uni-modal-wrap")},ajaxSynced:function(o){const i=this;o.success?(e("#js-modal-main-save-btn").removeClass("uni-active"),t._unblockForm("#uni-modal-wrap","success")):(i.model.set({imageData:i.originalModelSettings}),t._unblockForm("#uni-modal-wrap","error"))},closeModal:function(){this.$el.find("#uni-modal-image-logic-wrapper").remove(),this.undelegateEvents(),this.stopListening(),t._modal_on=!1},initialize:function(){this.originalModelSettings={},this.listenTo(this.model,"request",this.ajaxSent)},removeAllRules:function(){e(".uni-formula-conditional-rules-options-row").not(".uni-formula-conditional-rules-options-template").remove(),e(".uni_formula_conditional_rule_add").click()},render:function(){const o=this;t._modal_on=!0;const i=o.template({data:o.model.get("imageData"),vars:t._optionVars});return this.$el.append(i),e(document.body).trigger("builderius_image_logic_modal_opening",[o]),this},saveSettings:function(){const e=this,o=t._readSettingsModal(e),i=JSON.parse(JSON.stringify(e.model.get("imageData")));if(o.valid&&!t._ajax_sent){const t=o.data,n={action:"uni_cpo_save_image_data",security:builderiusCfg.security,success:function(t){e.ajaxSynced(t)},error:function(t){e.ajaxError(t)}};e.originalModelSettings=i,e.model.set({imageData:t}),e.model.sync("create",e.model,n)}}}),t.Views.WeightModal=Backbone.View.extend({el:"body",events:{"click .uni-close-modal":"closeModal","click #js-modal-main-cancel-btn":"closeModal","click .uni-rules-remove-all":"removeAllRules","click #js-modal-main-save-btn":"saveSettings","focus #uni-modal-weight-wrapper textarea":"getFocused"},template:_.template(e("#js-builderius-modal-weight-tmpl").html()),ajaxError:function(e){t._unblockForm("#uni-modal-wrap","error"),console.info(e.status,e.statusText)},ajaxSent:function(e,o,i){t._blockForm("#uni-modal-wrap")},ajaxSynced:function(o){const i=this;o.success?(e("#js-modal-main-save-btn").removeClass("uni-active"),t._unblockForm("#uni-modal-wrap","success")):(i.model.set({weightData:i.originalModelSettings}),t._unblockForm("#uni-modal-wrap","error"))},closeModal:function(){this.$el.find("#uni-modal-weight-wrapper").remove(),this.undelegateEvents(),this.stopListening(),t._modal_on=!1},getFocused:function(){const t=this;e(document).find("textarea.builderius-setting-field").on("focus",(function(){t.textarea=e(this)}))},initialize:function(){this.originalModelSettings={},this.listenTo(this.model,"request",this.ajaxSent)},removeAllRules:function(){e(".uni-formula-conditional-rules-options-row").not(".uni-formula-conditional-rules-options-template").remove(),e(".uni_formula_conditional_rule_add").click()},render:function(){const o=this;t._modal_on=!0;const i=o.template({data:o.model.get("weightData"),vars:t._optionVars});return this.$el.append(i),e(document.body).trigger("builderius_weight_modal_opening",[o]),this},saveSettings:function(){const e=this,o=t._readSettingsModal(e),i=JSON.parse(JSON.stringify(e.model.get("weightData")));if(o.valid&&!t._ajax_sent){const t=o.data,n={action:"uni_cpo_save_weight_data",security:builderiusCfg.security,success:function(t){e.ajaxSynced(t)},error:function(t){e.ajaxError(t)}};e.originalModelSettings=i,e.model.set({weightData:t}),e.model.sync("create",e.model,n)}}}),t.Views.ShippingClassModal=Backbone.View.extend({el:"body",events:{"click .uni-close-modal":"closeModal","click #js-modal-main-cancel-btn":"closeModal","click .uni-rules-remove-all":"removeAllRules","click #js-modal-main-save-btn":"saveSettings"},template:_.template(e("#js-builderius-modal-shipping-class-tmpl").html()),ajaxError:function(e){t._unblockForm("#uni-modal-wrap","error"),console.info(e.status,e.statusText)},ajaxSent:function(e,o,i){t._blockForm("#uni-modal-wrap")},ajaxSynced:function(o){const i=this;o.success?(e("#js-modal-main-save-btn").removeClass("uni-active"),t._unblockForm("#uni-modal-wrap","success")):(i.model.set({shippingClassData:i.originalModelSettings}),t._unblockForm("#uni-modal-wrap","error"))},closeModal:function(){this.$el.find("#uni-modal-shipping-class-wrapper").remove(),this.undelegateEvents(),this.stopListening(),t._modal_on=!1},initialize:function(){this.originalModelSettings={},this.listenTo(this.model,"request",this.ajaxSent)},removeAllRules:function(){e(".uni-formula-conditional-rules-options-row").not(".uni-formula-conditional-rules-options-template").remove(),e(".uni_formula_conditional_rule_add").click()},render:function(){const o=this;t._modal_on=!0;const i=o.template({data:o.model.get("shippingClassData"),vars:t._optionVars,shippingClasses:t._shipping_classes});return this.$el.append(i),e(document.body).trigger("builderius_shipping_class_modal_opening",[o]),this},saveSettings:function(){const e=this,o=t._readSettingsModal(e),i=JSON.parse(JSON.stringify(e.model.get("shippingClassData")));if(o.valid&&!t._ajax_sent){const t=o.data,n={action:"uni_cpo_save_shipping_class_data",security:builderiusCfg.security,success:function(t){e.ajaxSynced(t)},error:function(t){e.ajaxError(t)}};e.originalModelSettings=i,e.model.set({shippingClassData:t}),e.model.sync("create",e.model,n)}}}),t.Views.DimensionsModal=Backbone.View.extend({el:"body",events:{"click .uni-close-modal":"closeModal","click #js-modal-main-cancel-btn":"closeModal","click #js-modal-main-save-btn":"saveSettings"},template:_.template(e("#js-builderius-modal-dimensions-tmpl").html()),ajaxError:function(e){t._unblockForm("#uni-modal-wrap","error"),console.info(e.status,e.statusText)},ajaxSent:function(e,o,i){t._blockForm("#uni-modal-wrap")},ajaxSynced:function(o){const i=this;o.success?(e("#js-modal-main-save-btn").removeClass("uni-active"),t._unblockForm("#uni-modal-wrap","success")):(i.model.set({dimensionsData:i.originalModelSettings}),t._unblockForm("#uni-modal-wrap","error"))},closeModal:function(){this.$el.find("#uni-modal-dimensions-wrapper").remove(),this.undelegateEvents(),this.stopListening(),t._modal_on=!1},initialize:function(){this.originalModelSettings={},this.listenTo(this.model,"request",this.ajaxSent)},render:function(){const o=this;t._modal_on=!0;const i=o.template({data:o.model.get("dimensionsData"),vars:t._optionVars});return this.$el.append(i),e(document.body).trigger("builderius_dimensions_modal_opening",[o]),this},saveSettings:function(){const e=this,o=t._readSettingsModal(e),i=JSON.parse(JSON.stringify(e.model.get("dimensionsData")));if(o.valid&&!t._ajax_sent){const t=o.data,n={action:"uni_cpo_save_dimensions_data",security:builderiusCfg.security,success:function(t){e.ajaxSynced(t)},error:function(t){e.ajaxError(t)}};e.originalModelSettings=i,e.model.set({dimensionsData:t}),e.model.sync("create",e.model,n)}}}),t.Views.NovModal=Backbone.View.extend({el:"body",events:{"click .uni-close-modal":"closeModal","click #js-modal-nov-cancel-btn":"closeModal","click #js-modal-nov-save-btn":"saveSettings","click .uni-rules-remove-all":"removeAllRules","focus .uni-cpo-non-option-vars-options-row textarea":"getFocused",'change [data-uni-constrainer="yes"]':"updateConstrained","click .uni-matrix-import-btn":"importMatrixCsv"},template:_.template(e("#js-builderius-modal-nov-tmpl").html()),ajaxError:function(e){t._unblockForm("#uni-modal-wrap","error"),console.info(e.status,e.statusText)},ajaxSent:function(e,o,i){t._blockForm("#uni-modal-wrap")},ajaxSynced:function(o){const i=this;o.success?(e("#js-modal-nov-save-btn").removeClass("uni-active"),t._unblockForm("#uni-modal-wrap","success"),t._updateListOfVars()):(i.model.set({novData:i.originalModelSettings}),t._unblockForm("#uni-modal-wrap","error"))},closeModal:function(){this.$el.find("#uni-modal-nov-wrapper").remove(),this.undelegateEvents(),this.stopListening(),t._modal_on=!1},generateTable:function(e,o){const i=e.find(".uni-matrix-table-container").data("row"),n=e.find(".uni-matrix-table-container").attr("id"),a=e.find(".uni-matrix-json"),s=[],l=[];if(void 0===o){const t=e.find(".uni-matrix-data").val().split("|"),o=[];if(s.push({name:"rows",label:builderius_i18n.matrix_head,datatype:"double(4)",editable:!0}),t.forEach((function(e,t){s.push({name:e,label:e,datatype:"double(4)",editable:!0}),o.push(0)})),s.push({name:"action",label:"Action",datatype:"html",editable:!1,values:null}),o.unshift(""),""!==a.val()){JSON.parse(a.val()).forEach((function(e){l.push({id:e.id,values:e.columns})}))}else l.push({id:1,values:o})}else o.metadata.forEach((function(e,t){s.push({name:e,label:e,datatype:"double(4)",editable:!0})})),s.push({name:"action",label:"Action",datatype:"html",editable:!1,values:null}),o.data.forEach((function(e){l.push({id:e.id,values:e.columns})}));this.table[i]=new EditableGrid("Matrix["+i+"]",{enableSort:!1,editmode:"absolute",duplicate:function(e){const o=this.getRowValues(e);o.name=o.name+" (copy)";for(var i=0,a=0;a<this.getRowCount();a++)i=Math.max(i,parseInt(this.getRowId(a))+1);t._destroyScroll(n),this.insertAfter(e,i,o),t._initScroll(n)},tableRendered:function(e,t,o){const i=JSON.stringify(this.data);a.val(i)},modelChanged:function(e,t,o,i,n){const s=JSON.stringify(this.data);a.val(s)}}),this.table[i].load({metadata:s,data:l}),this.table[i].setCellRenderer("action",new CellRenderer({render:function(e,t){e.innerHTML='<a class="uni-generated-table-remove-row" data-row="'+e.rowIndex+'" style="cursor:pointer"><i class="fas fa-trash" alt="delete" title="Delete row"></i></a>',e.innerHTML+='&nbsp;<a class="uni-generated-table-clone-row" data-row="'+e.rowIndex+'" style="cursor:pointer"><i class="fas fa-copy" border="0" alt="duplicate" title="Duplicate row"></i></a>'}})),this.table[i].renderGrid(n,"uni-generated-table","js-generated-table"),t._initScroll(n)},getFocused:function(){const t=this;e(".uni-cpo-non-option-vars-options-row").find("textarea").on("focus",(function(){t.textarea=e(this)}))},importMatrixCsv:function(o){o.preventDefault();const i=this,n=e(o.target),a=n.closest(".uni-cpo-matrix-options-wrap"),s=a.find(".uni-matrix-table-container").attr("id"),l=(n.data("row"),n.prevAll("input[type=file]")[0].files[0]),r=new FormData;if(void 0!==l){const o={action:"uni_cpo_import_matrix",security:builderiusCfg.security};r.append("file",l),e.each(o,(function(e,t){r.append(e,t)})),e.ajax({url:builderiusCfg.ajax_url,data:r,method:"POST",processData:!1,contentType:!1,beforeSend:function(){t._blockForm("#uni-modal-wrap")},error:function(e){t._unblockForm("#uni-modal-wrap","error"),t._showMessage(e.statusText,"error"),console.info(e.status,e.statusText)},success:function(e){if(e.success){const o=a.find(".uni-matrix-data");let n=e.data.metadata;n.shift(),n=n.join("|"),o.val(n),t._destroyScroll(s),i.generateTable(a,e.data),t._unblockForm("#uni-modal-wrap","success")}else t._unblockForm("#uni-modal-wrap","error"),void 0!==e.data.error&&t._showMessage(e.data.error,"error")}})}},initialize:function(){this.originalModelSettings={},this.listenTo(this.model,"request",this.ajaxSent)},removeAllRules:function(){e(".uni-cpo-non-option-vars-options-row").not(".uni-cpo-non-option-vars-options-template").remove(),e(".uni_cpo_non_option_vars_option_add").click()},render:function(){t._modal_on=!0,this.table=[];const o=this,i=o.template({data:o.model.get("novData"),vars:t._optionVars});return this.$el.append(i),this.updateConstrained(),this.getFocused(),e(document.body).trigger("builderius_nov_modal_opening",[o]),this},saveSettings:function(){const e=this,o=t._readSettingsModal(e),i=JSON.parse(JSON.stringify(e.model.get("novData")));if(o.valid&&!t._ajax_sent){const t=o.data,n={action:"uni_cpo_save_nov_data",security:builderiusCfg.security,success:function(t){e.ajaxSynced(t)},error:function(t){e.ajaxError(t)}};e.originalModelSettings=i,e.model.set({novData:t}),e.model.sync("create",e.model,n)}},updateConstrained:function(e){t._conditionalFields(e)}}),e((function(){t._init()}))}(jQuery),function(e){function t(t,o){const i=e(t);if(i.length>0){const{wrapper:t,container:n,row:a,add:s,remove:l,move:r,template:c,filter:d,rules:u}=o;i.each((function(){e(this).repeatable_fields({wrapper:t,container:n,row:a,add:s,remove:l,move:r,template:c,is_sortable:!0,before_add:null,after_add:function(t,o){!function(t,o,i){let n=e(t).attr("data-rf-row-count");n++;const a=n-1;e("*",o).each((function(){e.each(this.attributes,(function(){this.value=this.value.replace("<%row-count%>",a)}))})),e(".uni-modal-btns-wrap .uni-btn-1.uni-modal-save-btn").addClass("uni-active"),update_everything(t,".uni-formula-conditional-rules-options-template"),e(o).find('textarea, input[type="hidden"], input[type="checkbox"], select.scheme-field').not(".wp-picker-clear, .flatpickr-hour, .flatpickr-minute, .cur-year").addClass("builderius-setting-field"),e(t).attr("data-rf-row-count",n);const s=e("#cpo-formula-rule-builder-"+a);s.empty(),i.length>0?(s.queryBuilder({icons:{add_group:"fa fa-plus-circle",add_rule:"fa fa-plus",remove_group:"fas fa-times",remove_rule:"fas fa-times",error:"fa fa-exclamation-circle"},allow_groups:1,filters:i}),s.on("afterAddRule afterDeleteRule.queryBuilder afterUpdateRuleValue.queryBuilder afterUpdateRuleFilter.queryBuilder afterUpdateRuleOperator.queryBuilder afterUpdateGroupCondition.queryBuilder",(function(t){e(t.target).next(".js-uni-fetch-scheme").removeClass("uni-cpo-settings-saved").addClass("uni-cpo-settings-unsaved")}))):s.text("No options variables found")}(t,o,d)},before_remove:null,after_remove:function(t){e(".uni-modal-btns-wrap .uni-btn-1.uni-modal-save-btn").addClass("uni-active"),update_everything(t,c)},sortable_options:{stop:function(){e(".js-uni-fetch-scheme").each((function(){e(this).trigger("click")}))}},row_count_placeholder:"<%row-count%>"})}))}}function o(t,o){const i=e(t);if(i.length>0){i.empty();const{filters:t}=o;if(t.length>0){const{icons:n,allow_groups:a,rules:s}=o;i.each((function(o){const i=e("#cpo-formula-rule-builder-"+o);if(i.length>0&&(i.queryBuilder({icons:n,allow_groups:a,filters:t}),void 0!==s[o]&&!_.isEmpty(s[o].rule))){finalRule=s[o].rule.replace(/\\/g,"");try{i.queryBuilder("setRules",JSON.parse(finalRule))}catch(e){console.warn("It looks like there is a problem with one of the rule for queryBuilder. Read below the full error message:"),console.error(e)}}})),i.on("afterAddRule afterDeleteRule.queryBuilder afterUpdateRuleValue.queryBuilder afterUpdateRuleFilter.queryBuilder afterUpdateRuleOperator.queryBuilder afterUpdateGroupCondition.queryBuilder",(function(t){e(t.target).next(".js-uni-fetch-scheme").removeClass("uni-cpo-settings-saved").addClass("uni-cpo-settings-unsaved")}))}else i.text("No options variables found")}}function i(t,o){let i=e(t).attr("data-rf-row-count");i++,e("*",o).each((function(){e.each(this.attributes,(function(e,t){this.value=this.value.replace("<%row-count%>",i-1)}))})),update_everything(t,".uni-cpo-non-option-vars-options-template"),e(o).find("textarea, input").not(".wp-picker-clear, .flatpickr-hour, .flatpickr-minute, .cur-year, .uni-cpo-non-option-vars-options-template textarea, .uni-cpo-non-option-vars-options-template input").addClass("builderius-setting-field"),e(o).find(".uni-cpo-convert-wrapper select, .uni-modal-select").addClass("builderius-setting-field");const n=e(o).find(".uni-cpo-non-option-vars-role");n.attr("data-uni-constrained","input[name=wholesale_enable]"),n.attr("data-uni-constvalue","on");const a=e(o).find(".uni-cpo-non-option-vars-role-fields");a.attr("data-uni-constrained","input[name=wholesale_enable]"),a.attr("data-uni-constvalue","on"),e(t).attr("data-rf-row-count",i),e("#js-modal-nov-save-btn").addClass("uni-active"),Builderius._conditionalFields()}let n;e(document.body).on("builderius_module_settings_modal_opening",(function(i,n){const a=e("#js-block-settings-modal"),s=Builderius._getQueryBuilderFilter(n.model),l=e(".uni-matrix-option-json"),r=n.model.get("type");e("#uni-modal-tabs").tabs({activate:function(e,t){"tab-cpo_matrix"===t.newPanel.attr("id")?""!==l.val()&&n.generateMatrixTable():"tab-cpo_matrix"===t.oldPanel.attr("id")&&Builderius._destroyScroll("uni-matrix-option-table-container")}}),Builderius._hidePremiumContent(e(".uni-premium-content")),a.on("click",".uni-variables-list li",(function(){return n.textarea.insertAtCaret(e(this).text().replace(/\s/g,"")),!1})),a.on("change","input, select, textarea",(function(t){const o=e(t.currentTarget);!o.parents(".cpo-query-rule-builder").length>0&&"sync[pid]"!==o.attr("name")&&"sync[type]"!==o.attr("name")&&e("#js-modal-save-btn").addClass("uni-active")})),a.on("click",".uni-matrix-generate-btn",(function(){n.generateMatrixTable()})),a.on("click",".uni-generated-table-remove-row",(function(){n.matrixTable.remove(e(this).data("row"))})),a.on("click",".uni-generated-table-clone-row",(function(){n.matrixTable.duplicate(e(this).data("row"))})),a.on("change",'.uni-matrix-import input[type="file"]',(function(){e(this).addClass("uni-chosen").closest(".uni-matrix-import").find("label").text("File chosen")})),a.on("change",'textarea[name^="cpo_matrix_data"]',(function(){e(this).closest('div[data-group="data"]').find(".uni-matrix-generate-btn").addClass("uni-active")})),e(".js-sync-posts").select2();const c=e("#builderius-setting-cpo_slug"),d=n.model.attributes?.pid;d&&c&&c.attr("disabled",!0);const u=e(".uni-select-option-repeat");if(u.length>0&&u.each((function(){e(this).repeatable_fields({wrapper:".uni-select-option-repeat-wrapper",container:".uni-select-option-options-wrapper",row:".uni-select-option-options-row",add:".uni_select_option_add",remove:".uni-select-option-remove-wrapper",move:".uni-select-option-move-wrapper",template:".uni-select-option-options-template",is_sortable:!0,before_add:null,after_add:function(t,o){!function(t,o,i){let n=e(t).attr("data-rf-row-count");n++,e("*",o).each((function(){e.each(this.attributes,(function(e,t){this.value=this.value.replace("<%row-count%>",n-1)}))})),e(o).find("textarea, input").not(".wp-picker-clear, .flatpickr-hour, .flatpickr-minute, .cur-year").addClass("builderius-setting-field"),e(t).attr("data-rf-row-count",n),e(o).find(".builderius-setting-colorpick").cs_wpColorPicker(),e(".uni-modal-btns-wrap .uni-btn-1.uni-modal-save-btn").addClass("uni-active"),update_everything(t,i)}(t,o,".uni-select-option-options-template")},before_remove:null,after_remove:function(t){e(".uni-modal-btns-wrap .uni-btn-1.uni-modal-save-btn").addClass("uni-active"),update_everything(t,".uni-select-option-options-template")},sortable_options:null,row_count_placeholder:"<%row-count%>"})})),void 0!==n.model.get("settings").cpo_conditional){const t=uniGet(n.model.get("settings"),"cpo_conditional.main.cpo_fc_scheme",{}),o=e("#cpo-field-rule-builder");if(o.length>0)if(o.empty(),s.length>0){if(o.queryBuilder({icons:{add_group:"fa fa-plus-circle",add_rule:"fa fa-plus",remove_group:"fas fa-times",remove_rule:"fas fa-times",error:"fa fa-exclamation-circle"},allow_groups:1,filters:s}),!_.isEmpty(t)){finalRule=t.replace(/\\/g,"");try{o.queryBuilder("setRules",JSON.parse(finalRule))}catch(i){console.warn("It looks like there is a problem with one of the rule for queryBuilder. Read below the full error message:"),console.error(i)}}o.on("afterAddRule afterDeleteRule.queryBuilder afterUpdateRuleValue.queryBuilder afterUpdateRuleFilter.queryBuilder afterUpdateRuleOperator.queryBuilder afterUpdateGroupCondition.queryBuilder",(function(t){e(t.target).next(".js-uni-fetch-scheme").removeClass("uni-cpo-settings-saved").addClass("uni-cpo-settings-unsaved")}))}else o.text("No options variables found")}if(void 0!==n.model.get("settings").cpo_rules){const e="datepicker"===r?Builderius._getQueryBuilderFilter(n.model,"date_rules"):s,i="datepicker"===r?uniGet(n.model.get("settings"),"cpo_rules.data.cpo_date_rules",{}):uniGet(n.model.get("settings"),"cpo_rules.main.cpo_sc_scheme",{}),a={icons:{add_group:"fa fa-plus-circle",add_rule:"fa fa-plus",remove_group:"fas fa-times",remove_rule:"fas fa-times",error:"fa fa-exclamation-circle"},allow_groups:1,filters:e,rules:i};t(".uni-formula-conditional-rules-repeat",{wrapper:".uni-formula-conditional-rules-repeat-wrapper",container:".uni-formula-conditional-rules-options-wrapper",row:".uni-formula-conditional-rules-options-row",add:".uni_formula_conditional_rule_add",remove:".uni_formula_conditional_rule_remove",move:".uni_formula_conditional_rule_move",template:".uni-formula-conditional-rules-options-template",filter:e,rules:i}),o(".cpo-query-rule-builder.query-builder-rcr",a)}if(void 0!==n.model.get("settings").cpo_validation){const e=uniGet(n.model.get("settings"),"cpo_validation.logic.cpo_vc_scheme",{}),i={icons:{add_group:"fa fa-plus-circle",add_rule:"fa fa-plus",remove_group:"fas fa-times",remove_rule:"fas fa-times",error:"fa fa-exclamation-circle"},allow_groups:1,filters:s,rules:e};t(".uni-formula-conditional-rules-repeat",{wrapper:".uni-formula-conditional-rules-repeat-wrapper",container:".uni-formula-conditional-rules-options-wrapper",row:".uni-formula-conditional-rules-options-row",add:".uni_formula_conditional_rule_add",remove:".uni_formula_conditional_rule_remove",move:".uni_formula_conditional_rule_move",template:".uni-formula-conditional-rules-options-template",filter:s,rules:e}),o(".cpo-query-rule-builder.query-builder-vcr",i)}if(e(".builderius-setting-colorpick").not('[name*="<%row-count%>"]').cs_wpColorPicker(),a.on("change",'[name="cpo_mode_radio"], [name="cpo_mode_checkbox"]',(function(){const t=e(this).val();"image"===t||"text"===t?(e('[data-group="border"] [name="color"]').val("#d7d7d7"),e('[data-group="border"] [name="color_active"]').val("#333333"),e('[data-group="main"] [name="width_px"]').val(""),e('[name="offset_px"]').val("")):(e('[data-group="main"] [name="width_px"]').val("42"),e('[name="offset_px"]').val("2"))})),$datepickers=jQuery(".builderius-setting-datepicker"),$datepickers.length>0){const{weekdays:t,months:o,scrollTitle:i,toggleTitle:a}=builderius_i18n.flatpickr,s={weekdays:t,months:o,daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],firstDayOfWeek:0,ordinal:e=>{const t=e%100;if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},rangeSeparator:" - ",weekAbbreviation:"Wk",scrollTitle:i,toggleTitle:a,amPM:["AM","PM"]};e.each($datepickers,(function(t,o){const i=e(o),a=uniFindValueByKey(n.model.get("settings"),o.name),l=i.closest("div")[0];let r=!1,c=!1;if(i.hasClass("datepicker-calendar-disabled")&&i.hasClass("timepicker-enabled")&&(r=!0,c=!0),i.hasClass("datepicker-mode-multiple")){let e;void 0!==a&&(e=a.split(", ")),i.flatpickr({locale:s,enableTime:c,noCalendar:r,defaultValue:e,appendTo:l,mode:"multiple"})}else if(i.hasClass("datepicker-mode-range")){let e;void 0!==a&&(e=a.split(" - ")),i.flatpickr({locale:s,enableTime:c,noCalendar:r,defaultValue:e,appendTo:l,mode:"range"})}else{let e;void 0!==a&&(e=a),i.flatpickr({locale:s,enableTime:c,noCalendar:r,defaultValue:e,appendTo:l})}}))}Builderius._initTooltip(a,"center bottom","center top-10")})),e(document.body).on("builderius_main_formula_modal_opening",(function(i,n){const a=e("#uni-modal-main-formula-wrapper");a.on("click",".uni-variables-list li",(function(){return void 0!==n.textarea&&n.textarea.insertAtCaret(e(this).text().replace(/\s/g,"")),!1})),a.on("change","input, select, textarea",(function(t){e(t.currentTarget).parents(".cpo-query-rule-builder").length||e("#js-modal-main-save-btn").addClass("uni-active")}));const s=Builderius._getQueryBuilderFilter("","formula_rules"),l=uniGet(n.model.get("formulaData"),"formula_scheme",{}),r={icons:{add_group:"fa fa-plus-circle",add_rule:"fa fa-plus",remove_group:"fas fa-times",remove_rule:"fas fa-times",error:"fa fa-exclamation-circle"},allow_groups:1,filters:s,rules:l};t(".uni-formula-conditional-rules-repeat",{wrapper:".uni-formula-conditional-rules-repeat-wrapper",container:".uni-formula-conditional-rules-options-wrapper",row:".uni-formula-conditional-rules-options-row",add:".uni_formula_conditional_rule_add",remove:".uni_formula_conditional_rule_remove",move:".uni_formula_conditional_rule_move",template:".uni-formula-conditional-rules-options-template",filter:s,rules:l}),o(".cpo-query-rule-builder",r)})),e(document.body).on("builderius_image_logic_modal_opening",(function(i,n){const a=e("#uni-modal-image-logic-wrapper");a.on("change","input, select, textarea",(function(t){e(t.currentTarget).parents(".cpo-query-rule-builder").length||e("#js-modal-main-save-btn").addClass("uni-active")}));const s=Builderius._getQueryBuilderFilter().filter((function(e){return!e.id.startsWith("uni_nov_cpo")})),l=uniGet(n.model.get("imageData"),"image_scheme",{}),r={icons:{add_group:"fa fa-plus-circle",add_rule:"fa fa-plus",remove_group:"fas fa-times",remove_rule:"fas fa-times",error:"fa fa-exclamation-circle"},allow_groups:1,filters:s,rules:l};t(".uni-formula-conditional-rules-repeat",{wrapper:".uni-formula-conditional-rules-repeat-wrapper",container:".uni-formula-conditional-rules-options-wrapper",row:".uni-formula-conditional-rules-options-row",add:".uni_formula_conditional_rule_add",remove:".uni_formula_conditional_rule_remove",move:".uni_formula_conditional_rule_move",template:".uni-formula-conditional-rules-options-template",filter:s,rules:l}),o(".cpo-query-rule-builder",r),Builderius._initTooltip(a,"center bottom","center top-10")})),e(document.body).on("builderius_weight_modal_opening",(function(i,n){const a=e("#uni-modal-weight-wrapper");a.on("click",".uni-variables-list li",(function(){return void 0!==n.textarea&&n.textarea.insertAtCaret(e(this).text().replace(/\s/g,"")),!1})),a.on("change","input, select, textarea",(function(t){e(t.currentTarget).parents(".cpo-query-rule-builder").length||e("#js-modal-main-save-btn").addClass("uni-active")}));const s=Builderius._getQueryBuilderFilter(),l=uniGet(n.model.get("weightData"),"weight_scheme",{}),r={icons:{add_group:"fa fa-plus-circle",add_rule:"fa fa-plus",remove_group:"fas fa-times",remove_rule:"fas fa-times",error:"fa fa-exclamation-circle"},allow_groups:1,filters:s,rules:l};t(".uni-formula-conditional-rules-repeat",{wrapper:".uni-formula-conditional-rules-repeat-wrapper",container:".uni-formula-conditional-rules-options-wrapper",row:".uni-formula-conditional-rules-options-row",add:".uni_formula_conditional_rule_add",remove:".uni_formula_conditional_rule_remove",move:".uni_formula_conditional_rule_move",template:".uni-formula-conditional-rules-options-template",filter:s,rules:l}),o(".cpo-query-rule-builder",r)})),e(document.body).on("builderius_shipping_class_modal_opening",(function(i,n){const a=e("#uni-modal-shipping_class-wrapper");a.on("click",".uni-variables-list li",(function(){return void 0!==n.textarea&&n.textarea.insertAtCaret(e(this).text().replace(/\s/g,"")),!1})),a.on("change","input, select, textarea",(function(t){e(t.currentTarget).parents(".cpo-query-rule-builder").length||e("#js-modal-main-save-btn").addClass("uni-active")}));const s=Builderius._getQueryBuilderFilter(),l=uniGet(n.model.get("shippingClassData"),"shipping_class_scheme",{}),r={icons:{add_group:"fa fa-plus-circle",add_rule:"fa fa-plus",remove_group:"fas fa-times",remove_rule:"fas fa-times",error:"fa fa-exclamation-circle"},allow_groups:1,filters:s,rules:l};t(".uni-formula-conditional-rules-repeat",{wrapper:".uni-formula-conditional-rules-repeat-wrapper",container:".uni-formula-conditional-rules-options-wrapper",row:".uni-formula-conditional-rules-options-row",add:".uni_formula_conditional_rule_add",remove:".uni_formula_conditional_rule_remove",move:".uni_formula_conditional_rule_move",template:".uni-formula-conditional-rules-options-template",filter:s,rules:l}),o(".cpo-query-rule-builder",r)})),e(document.body).on("builderius_dimensions_modal_opening",(function(t,o){e("#uni-modal-dimensions-wrapper").on("change","input, select, textarea",(function(t){e(t.currentTarget).parents(".cpo-query-rule-builder").length||e("#js-modal-main-save-btn").addClass("uni-active")}))})),e(document.body).on("builderius_nov_modal_opening",(function(t,o){const n=".uni-cpo-matrix-options-wrap",a=e("#uni-modal-nov-wrapper"),s=".uni-matrix-table-container",l=e(".uni-matrix-json");l.length>0&&l.each((function(){if(""!==e(this).val()){const t=e(this).closest(n);o.generateTable(t)}})),a.on("click",".uni-variables-list li",(function(){return o.textarea.insertAtCaret(e(this).text().replace(/\s/g,"")),!1})),a.on("click",".uni-matrix-generate-btn",(function(){const t=e(this).closest(n);o.generateTable(t)})),a.on("click",".uni-generated-table-remove-row",(function(){const t=e(this).closest(n).find(s).data("row");o.table[t].remove(e(this).data("row"))})),a.on("click",".uni-generated-table-clone-row",(function(){const t=e(this).closest(n).find(s).data("row");o.table[t].duplicate(e(this).data("row"))})),a.on("change",'.uni-matrix-import input[type="file"]',(function(){e(this).addClass("uni-chosen").closest(".uni-matrix-import").find("label").text("File chosen")})),a.on("change","input, select, textarea",(function(){e("#js-modal-nov-save-btn").addClass("uni-active")}));const r=e(".uni-cpo-non-option-vars-options-repeat");r.length>0&&r.each((function(){e(this).repeatable_fields({wrapper:".uni-cpo-non-option-vars-options-repeat-wrapper",container:".uni-cpo-non-option-vars-options-wrapper",row:".uni-cpo-non-option-vars-options-row",add:".uni_cpo_non_option_vars_option_add",remove:".uni-cpo-non-option-vars-options-rules-remove-wrapper",move:".uni-cpo-non-option-vars-options-move-wrapper",template:".uni-cpo-non-option-vars-options-template",is_sortable:!0,before_add:null,after_add:function(e,t){i(e,t)},before_remove:null,after_remove:function(t){e("#js-modal-nov-save-btn").addClass("uni-active"),update_everything(t,".uni-cpo-non-option-vars-options-template")},sortable_options:null,row_count_placeholder:"<%row-count%>"})}))})),e(document.body).on("builderius_general_settings_modal_opening",(function(t,o){const i=e("#uni-modal-general-settings-wrapper");e("#uni-modal-tabs").tabs({activate:function(e,t){}}),i.on("change",'input:not([type="file"]):not(#js-cpo-export-email):not(#js-cpo-import-preference-checkbox), select:not(.js-sync-products), textarea',(function(){e("#js-modal-main-save-btn").addClass("uni-active")})),i.on("change",'.uni-import-file-wrap input[type="file"]',(function(){e(this).addClass("uni-chosen").closest(".uni-import-file-wrap").find("label").text("File chosen")})),Builderius._hidePremiumContent(e(".uni-premium-content"))})),e(document.body).on("builderius_cart_discounts_modal_opening",(function(t,o){const n=e("#uni-modal-cart-discounts-wrapper");e("#uni-modal-tabs").tabs({activate:function(e,t){}}),n.on("change","input, select, textarea",(function(){e("#js-modal-main-save-btn").addClass("uni-active")}));const a=e(".uni-cpo-non-option-vars-options-repeat");a.length>0&&a.each((function(){e(this).repeatable_fields({wrapper:".uni-cpo-non-option-vars-options-repeat-wrapper",container:".uni-cpo-non-option-vars-options-wrapper",row:".uni-cpo-non-option-vars-options-row",add:".uni_cpo_non_option_vars_option_add",remove:".uni-cpo-non-option-vars-options-rules-remove-wrapper",move:".uni-cpo-non-option-vars-options-move-wrapper",template:".uni-cpo-non-option-vars-options-template",is_sortable:!0,before_add:null,after_add:function(e,t){i(e,t)},before_remove:null,after_remove:function(t){e("#js-modal-nov-save-btn").addClass("uni-active"),update_everything(t,".uni-cpo-non-option-vars-options-template")},sortable_options:null,row_count_placeholder:"<%row-count%>"})}))})),e(document.body).on("click",".js-uni-fetch-scheme",(function(){if(Builderius._queryBuilderFilter.length>0){const t=e(this),o=t.prev(".cpo-query-rule-builder, .cpo-query-rule-builder-single"),i=t.data("id"),n=o.queryBuilder("getRules");n?(void 0!==i?e("#uni_cpo_formula_rule_scheme-"+i).empty().val(JSON.stringify(n,void 0,2)):e("#uni_cpo_field_rule_scheme").empty().val(JSON.stringify(n,void 0,2)),t.removeClass("uni-cpo-settings-unsaved").addClass("uni-cpo-settings-saved"),e("#js-modal-main-save-btn, #js-modal-save-btn, #js-modal-main-save-btn").addClass("uni-active")):(t.removeClass("uni-cpo-settings-saved").addClass("uni-cpo-settings-unsaved"),e("#js-modal-main-save-btn, #js-modal-save-btn, #js-modal-main-save-btn").removeClass("uni-active"))}})),window.Parsley.on("field:error",(function(){const t=this.$element.data("parsley-id"),o=this.$element.outerWidth(),i=e("#parsley-id-"+t);i.position({of:this.$element,my:"left top",at:"left bottom",collision:"none"}),i.css({"max-width":o,opacity:1});const n=this.$element.closest(".uni-tab-content").attr("id");e('[href="#'+n+'"]').closest("li").addClass("uni-warning")})),window.Parsley.on("field:success",(function(){if(!e(".parsley-error").length>0){const t=this.$element.closest(".uni-tab-content").attr("id");e('[href="#'+t+'"]').closest("li").removeClass("uni-warning")}})),e(document).on("change focusin focusout",".js-cpo-label-slug-field",(function(){try{const t=e(this),o=t.val(),i=t.attr("data-related-slug"),n=e(`#builderius-setting-${i}`);n.val()||(n.val(o),n.uniConvertToSlug(),n.parsley().validate())}catch(e){console.error(e)}})),e(document).on("change focusin focusout",".js-cpo-slug-field",(function(){const t=e(this);this.value||(t.uniConvertToSlug(),t.parsley().validate())})),e(document).on("change focusin focusout",".js-cpo-custom-values-field",(function(){e(this).parsley().validate()})),e(document).on("change focusin focusout",".js-cpo-rate-field, .rule-value-container input",(function(){const t=e(this),o=t.val().replace(/,/,".");t.val(o),t.parsley().validate()})),e(document).on("click",".cpo-upload-attachment",(function(t){t.preventDefault();const o=e(t.target).parents("div").first(),i=o.find(".cpo_suboption_attach_id"),a=o.find(".cpo_suboption_attach_uri"),s=o.find(".cpo_suboption_attach_name"),l=o.find(".cpo-remove-attachment"),r=o.find(".cpo-image-preview"),c=o.find(".cpo-image-title"),d=e('input[name="imagify_base_image"]');void 0!==n&&n.close(),n=wp.media({frame:"post",state:"insert",multiple:!1}),n.on("insert",(function(){const t=n.state().get("selection").first().toJSON();i.val(t.id),d.length&&d.val(t.id),a.length>0&&a.val(t.url),s.length>0&&s.val(t.filename),l.show();const o=e("<img>").attr("src",t.url);r.length>0&&r.empty().append(o),c.length>0&&c.empty().append(t.filename)})),n.open()})),e(document).on("click",".cpo-remove-attachment",(function(t){t.preventDefault();const o=e(t.target),i=o.parents("div").first(),n=i.find(".cpo_suboption_attach_id"),a=i.find(".cpo_suboption_attach_uri"),s=i.find(".cpo_suboption_attach_name"),l=i.find(".cpo-image-preview"),r=i.find(".cpo-image-title"),c=e('input[name="imagify_base_image"]');n.val(""),c.length&&c.val(""),a.length>0&&a.val(""),s.length>0&&s.val(""),o.hide(),l.length>0&&l.empty(),r.length>0&&r.empty()})),e(document).on("click",".uni-cpo-deselectable-input",(function(){const e=this;jQuery(".uni-cpo-deselectable-input").each((function(){e!==this&&(this.checked=!1)})),a===this&&this.checked?(this.checked=!1,a=null):a=this}));let a=null}(jQuery);